(function(){UEDITOR_CONFIG=window.UEDITOR_CONFIG||{};window.UE={plugins:{},commands:{},instants:{},I18N:{},version:"mini1.0.0.0"};var dom=UE.dom={};var browser=UE.browser=function(){var agent=navigator.userAgent.toLowerCase(),opera=window.opera,browser={ie:!!window.ActiveXObject,opera:(!!opera&&opera.version),webkit:(agent.indexOf(" applewebkit/")>-1),mac:(agent.indexOf("macintosh")>-1),quirks:(document.compatMode=="BackCompat")};browser.gecko=(navigator.product=="Gecko"&&!browser.webkit&&!browser.opera);var version=0;if(browser.ie){version=parseFloat(agent.match(/msie (\d+)/)[1]);browser.ie9Compat=document.documentMode==9;browser.ie8=!!document.documentMode;browser.ie8Compat=document.documentMode==8;browser.ie7Compat=((version==7&&!document.documentMode)||document.documentMode==7);browser.ie6Compat=(version<7||browser.quirks);browser.ie9above=version>8;browser.ie9below=version<9;}if(browser.gecko){var geckoRelease=agent.match(/rv:([\d\.]+)/);if(geckoRelease){geckoRelease=geckoRelease[1].split(".");version=geckoRelease[0]*10000+(geckoRelease[1]||0)*100+(geckoRelease[2]||0)*1;}}if(/chrome\/(\d+\.\d)/i.test(agent)){browser.chrome=+RegExp["\x241"];}if(/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(agent)&&!/chrome/i.test(agent)){browser.safari=+(RegExp["\x241"]||RegExp["\x242"]);}if(browser.opera){version=parseFloat(opera.version());}if(browser.webkit){version=parseFloat(agent.match(/ applewebkit\/(\d+)/)[1]);}browser.version=version;browser.isCompatible=!browser.mobile&&((browser.ie&&version>=6)||(browser.gecko&&version>=10801)||(browser.opera&&version>=9.5)||(browser.air&&version>=1)||(browser.webkit&&version>=522)||false);return browser;}();var ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera;var utils=UE.utils={each:function(obj,iterator,context){if(obj==null){return;}if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)===false){return false;}}}else{for(var key in obj){if(obj.hasOwnProperty(key)){if(iterator.call(context,obj[key],key,obj)===false){return false;}}}}},makeInstance:function(obj){var noop=new Function();noop.prototype=obj;obj=new noop;noop.prototype=null;return obj;},extend:function(t,s,b){if(s){for(var k in s){if(!b||!t.hasOwnProperty(k)){t[k]=s[k];}}}return t;},extend2:function(t){var a=arguments;for(var i=1;i<a.length;i++){var x=a[i];for(var k in x){if(!t.hasOwnProperty(k)){t[k]=x[k];}}}return t;},inherits:function(subClass,superClass){var oldP=subClass.prototype,newP=utils.makeInstance(superClass.prototype);utils.extend(newP,oldP,true);subClass.prototype=newP;return(newP.constructor=subClass);},bind:function(fn,context){return function(){return fn.apply(context,arguments);};},defer:function(fn,delay,exclusion){var timerID;return function(){if(exclusion){clearTimeout(timerID);}timerID=setTimeout(fn,delay);};},indexOf:function(array,item,start){var index=-1;start=this.isNumber(start)?start:0;this.each(array,function(v,i){if(i>=start&&v===item){index=i;return false;}});return index;},removeItem:function(array,item){for(var i=0,l=array.length;i<l;i++){if(array[i]===item){array.splice(i,1);i--;}}},trim:function(str){return str.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"");},listToMap:function(list){if(!list){return{};}list=utils.isArray(list)?list:list.split(",");for(var i=0,ci,obj={};ci=list[i++];){obj[ci.toUpperCase()]=obj[ci]=1;}return obj;},unhtml:function(str,reg){return str?str.replace(reg||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(a,b){if(b){return a;}else{return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a];}}):"";},html:function(str){return str?str.replace(/&((g|l|quo)t|amp|#39);/g,function(m){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[m];}):"";},cssStyleToDomStyle:function(){var test=document.createElement("div").style,cache={"float":test.cssFloat!=undefined?"cssFloat":test.styleFloat!=undefined?"styleFloat":"float"};return function(cssName){return cache[cssName]||(cache[cssName]=cssName.toLowerCase().replace(/-./g,function(match){return match.charAt(1).toUpperCase();}));};}(),loadFile:function(){var tmpList=[];function getItem(doc,obj){try{for(var i=0,ci;ci=tmpList[i++];){if(ci.doc===doc&&ci.url==(obj.src||obj.href)){return ci;}}}catch(e){return null;}}return function(doc,obj,fn){var item=getItem(doc,obj);if(item){if(item.ready){fn&&fn();}else{item.funs.push(fn);}return;}tmpList.push({doc:doc,url:obj.src||obj.href,funs:[fn]});if(!doc.body){var html=[];for(var p in obj){if(p=="tag"){continue;}html.push(p+'="'+obj[p]+'"');}doc.write("<"+obj.tag+" "+html.join(" ")+" ></"+obj.tag+">");return;}if(obj.id&&doc.getElementById(obj.id)){return;}var element=doc.createElement(obj.tag);delete obj.tag;for(var p in obj){element.setAttribute(p,obj[p]);}element.onload=element.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){item=getItem(doc,obj);if(item.funs.length>0){item.ready=1;for(var fi;fi=item.funs.pop();){fi();}}element.onload=element.onreadystatechange=null;}};element.onerror=function(){throw Error("The load "+(obj.href||obj.src)+" fails,check the url settings of file ueditor.config.js ");};doc.getElementsByTagName("head")[0].appendChild(element);};}(),isEmptyObject:function(obj){if(obj==null){return true;}if(this.isArray(obj)||this.isString(obj)){return obj.length===0;}for(var key in obj){if(obj.hasOwnProperty(key)){return false;}}return true;},fixColor:function(name,value){if(/color/i.test(name)&&/rgba?/.test(value)){var array=value.split(",");if(array.length>3){return"";}value="#";for(var i=0,color;color=array[i++];){color=parseInt(color.replace(/[^\d]/gi,""),10).toString(16);value+=color.length==1?"0"+color:color;}value=value.toUpperCase();}return value;},clone:function(source,target){var tmp;target=target||{};for(var i in source){if(source.hasOwnProperty(i)){tmp=source[i];if(typeof tmp=="object"){target[i]=utils.isArray(tmp)?[]:{};utils.clone(source[i],target[i]);}else{target[i]=tmp;}}}return target;},transUnitToPx:function(val){if(!/(pt|cm)/.test(val)){return val;}var unit;val.replace(/([\d.]+)(\w+)/,function(str,v,u){val=v;unit=u;});switch(unit){case"cm":val=parseFloat(val)*25;break;case"pt":val=Math.round(parseFloat(val)*96/72);}return val+(val?"px":"");},domReady:function(){var fnArr=[];function doReady(doc){doc.isReady=true;for(var ci;ci=fnArr.pop();ci()){}}return function(onready,win){win=win||window;var doc=win.document;onready&&fnArr.push(onready);if(doc.readyState==="complete"){doReady(doc);}else{doc.isReady&&doReady(doc);if(browser.ie){(function(){if(doc.isReady){return;}try{doc.documentElement.doScroll("left");}catch(error){setTimeout(arguments.callee,0);return;}doReady(doc);})();win.attachEvent("onload",function(){doReady(doc);});}else{doc.addEventListener("DOMContentLoaded",function(){doc.removeEventListener("DOMContentLoaded",arguments.callee,false);doReady(doc);},false);win.addEventListener("load",function(){doReady(doc);},false);}}};}(),cssRule:browser.ie?function(key,style,doc){var indexList,index;doc=doc||document;if(doc.indexList){indexList=doc.indexList;}else{indexList=doc.indexList={};}var sheetStyle;if(!indexList[key]){if(style===undefined){return"";}sheetStyle=doc.createStyleSheet("",index=doc.styleSheets.length);indexList[key]=index;}else{sheetStyle=doc.styleSheets[indexList[key]];}if(style===undefined){return sheetStyle.cssText;}sheetStyle.cssText=style||"";}:function(key,style,doc){doc=doc||document;var head=doc.getElementsByTagName("head")[0],node;if(!(node=doc.getElementById(key))){if(style===undefined){return"";}node=doc.createElement("style");node.id=key;head.appendChild(node);}if(style===undefined){return node.innerHTML;}if(style!==""){node.innerHTML=style;}else{head.removeChild(node);}}};utils.each(["String","Function","Array","Number","RegExp","Object"],function(v){UE.utils["is"+v]=function(obj){return Object.prototype.toString.apply(obj)=="[object "+v+"]";};});var EventBase=UE.EventBase=function(){};EventBase.prototype={addListener:function(types,listener){types=utils.trim(types).split(" ");for(var i=0,ti;ti=types[i++];){getListener(this,ti,true).push(listener);}},removeListener:function(types,listener){types=utils.trim(types).split(" ");for(var i=0,ti;ti=types[i++];){utils.removeItem(getListener(this,ti)||[],listener);}},fireEvent:function(){var types=arguments[0];types=utils.trim(types).split(" ");for(var i=0,ti;ti=types[i++];){var listeners=getListener(this,ti),r,t,k;if(listeners){k=listeners.length;while(k--){if(!listeners[k]){continue;}t=listeners[k].apply(this,arguments);if(t===true){return t;}if(t!==undefined){r=t;}}}if(t=this["on"+ti.toLowerCase()]){r=t.apply(this,arguments);}}return r;}};function getListener(obj,type,force){var allListeners;type=type.toLowerCase();return((allListeners=(obj.__allListeners||force&&(obj.__allListeners={})))&&(allListeners[type]||force&&(allListeners[type]=[])));}var dtd=dom.dtd=(function(){function _(s){for(var k in s){s[k.toUpperCase()]=s[k];}return s;}var X=utils.extend2;var A=_({isindex:1,fieldset:1}),B=_({input:1,button:1,select:1,textarea:1,label:1}),C=X(_({a:1}),B),D=X({iframe:1},C),E=_({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),F=_({ins:1,del:1,script:1,style:1}),G=X(_({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),F),H=X(_({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),G),I=X(_({p:1}),H),J=X(_({iframe:1}),H,B),K=_({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),L=X(_({a:0}),J),M=_({tr:1}),N=_({"#":1}),O=X(_({param:1}),K),P=X(_({form:1}),A,D,E,I),Q=_({li:1,ol:1,ul:1}),R=_({style:1,script:1}),S=_({base:1,link:1,meta:1,title:1}),T=X(S,R),U=_({head:1,body:1}),V=_({html:1});var block=_({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),empty=_({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return _({$nonBodyContent:X(V,U,S),$block:block,$inline:L,$inlineWithA:X(_({a:1}),L),$body:X(_({script:1,style:1}),block),$cdata:_({script:1,style:1}),$empty:empty,$nonChild:_({iframe:1,textarea:1}),$listItem:_({dd:1,dt:1,li:1}),$list:_({ul:1,ol:1,dl:1}),$isNotEmpty:_({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:_({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:_({"p":1,"div":1}),$tableContent:_({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:_({pre:1,script:1,style:1,textarea:1}),p:X(_({"a":1}),L)});})();var attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]);var domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&browser.version=="6"?"\ufeff":"\u200B",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(nodeA,nodeB){if(nodeA===nodeB){return 0;}var node,parentsA=[nodeA],parentsB=[nodeB];node=nodeA;while(node=node.parentNode){if(node===nodeB){return 10;}parentsA.push(node);}node=nodeB;while(node=node.parentNode){if(node===nodeA){return 20;}parentsB.push(node);}parentsA.reverse();parentsB.reverse();if(parentsA[0]!==parentsB[0]){return 1;}var i=-1;while(i++,parentsA[i]===parentsB[i]){}nodeA=parentsA[i];nodeB=parentsB[i];while(nodeA=nodeA.nextSibling){if(nodeA===nodeB){return 4;}}return 2;},getNodeIndex:function(node,ignoreTextNode){var preNode=node,i=0;while(preNode=preNode.previousSibling){if(ignoreTextNode&&preNode.nodeType==3){if(preNode.nodeType!=preNode.nextSibling.nodeType){i++;}continue;}i++;}return i;},inDoc:function(node,doc){return domUtils.getPosition(node,doc)==10;},findParent:function(node,filterFn,includeSelf){if(node&&!domUtils.isBody(node)){node=includeSelf?node:node.parentNode;while(node){if(!filterFn||filterFn(node)||domUtils.isBody(node)){return filterFn&&!filterFn(node)&&domUtils.isBody(node)?null:node;}node=node.parentNode;}}return null;},findParentByTagName:function(node,tagNames,includeSelf,excludeFn){tagNames=utils.listToMap(utils.isArray(tagNames)?tagNames:[tagNames]);return domUtils.findParent(node,function(node){return tagNames[node.tagName]&&!(excludeFn&&excludeFn(node));},includeSelf);},findParents:function(node,includeSelf,filterFn,closerFirst){var parents=includeSelf&&(filterFn&&filterFn(node)||!filterFn)?[node]:[];while(node=domUtils.findParent(node,filterFn)){parents.push(node);}return closerFirst?parents:parents.reverse();},insertAfter:function(node,newNode){return node.parentNode.insertBefore(newNode,node.nextSibling);},remove:function(node,keepChildren){var parent=node.parentNode,child;if(parent){if(keepChildren&&node.hasChildNodes()){while(child=node.firstChild){parent.insertBefore(child,node);}}parent.removeChild(node);}return node;},isBookmarkNode:function(node){return node.nodeType==1&&node.id&&/^_baidu_bookmark_/i.test(node.id);},getWindow:function(node){var doc=node.ownerDocument||node;return doc.defaultView||doc.parentWindow;},split:function(node,offset){var doc=node.ownerDocument;if(browser.ie&&offset==node.nodeValue.length){var next=doc.createTextNode("");return domUtils.insertAfter(node,next);}var retval=node.splitText(offset);if(browser.ie8){var tmpNode=doc.createTextNode("");domUtils.insertAfter(retval,tmpNode);domUtils.remove(tmpNode);}return retval;},isWhitespace:function(node){return !new RegExp("[^ \t\n\r"+domUtils.fillChar+"]").test(node.nodeValue);},getXY:function(element){var x=0,y=0;while(element.offsetParent){y+=element.offsetTop;x+=element.offsetLeft;element=element.offsetParent;}return{"x":x,"y":y};},on:function(element,type,handler){var types=utils.isArray(type)?type:[type],k=types.length;if(k){while(k--){type=types[k];if(element.addEventListener){element.addEventListener(type,handler,false);}else{if(!handler._d){handler._d={els:[]};}var key=type+handler.toString(),index=utils.indexOf(handler._d.els,element);if(!handler._d[key]||index==-1){if(index==-1){handler._d.els.push(element);}if(!handler._d[key]){handler._d[key]=function(evt){return handler.call(evt.srcElement,evt||window.event);};}element.attachEvent("on"+type,handler._d[key]);}}}}element=null;},un:function(element,type,handler){var types=utils.isArray(type)?type:[type],k=types.length;if(k){while(k--){type=types[k];if(element.removeEventListener){element.removeEventListener(type,handler,false);}else{var key=type+handler.toString();try{element.detachEvent("on"+type,handler._d?handler._d[key]:handler);}catch(e){}if(handler._d&&handler._d[key]){var index=utils.indexOf(handler._d.els,element);if(index!=-1){handler._d.els.splice(index,1);}handler._d.els.length==0&&delete handler._d[key];}}}}},isBlockElm:function(node){return node.nodeType==1&&(dtd.$block[node.tagName]||styleBlock[domUtils.getComputedStyle(node,"display")])&&!dtd.$nonChild[node.tagName];},getElementsByTagName:function(node,name,filter){if(filter&&utils.isString(filter)){var className=filter;filter=function(node){var result=false;$.each(utils.trim(className).replace(/[ ]{2,}/g," ").split(" "),function(i,v){if($(node).hasClass(v)){result=true;return false;}});return result;};}name=utils.trim(name).replace(/[ ]{2,}/g," ").split(" ");var arr=[];for(var n=0,ni;ni=name[n++];){var list=node.getElementsByTagName(ni);for(var i=0,ci;ci=list[i++];){if(!filter||filter(ci)){arr.push(ci);}}}return arr;},unSelectable:ie||browser.opera?function(node){node.onselectstart=function(){return false;};node.onclick=node.onkeyup=node.onkeydown=function(){return false;};node.unselectable="on";node.setAttribute("unselectable","on");for(var i=0,ci;ci=node.all[i++];){switch(ci.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:ci.unselectable="on";node.setAttribute("unselectable","on");}}}:function(node){node.style.MozUserSelect=node.style.webkitUserSelect=node.style.KhtmlUserSelect="none";},removeAttributes:function(node,attrNames){attrNames=utils.isArray(attrNames)?attrNames:utils.trim(attrNames).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,ci;ci=attrNames[i++];){ci=attrFix[ci]||ci;switch(ci){case"className":node[ci]="";break;case"style":node.style.cssText="";!browser.ie&&node.removeAttributeNode(node.getAttributeNode("style"));}node.removeAttribute(ci);}},createElement:function(doc,tag,attrs){return domUtils.setAttributes(doc.createElement(tag),attrs);},setAttributes:function(node,attrs){for(var attr in attrs){if(attrs.hasOwnProperty(attr)){var value=attrs[attr];switch(attr){case"class":node.className=value;break;case"style":node.style.cssText=node.style.cssText+";"+value;break;case"innerHTML":node[attr]=value;break;case"value":node.value=value;break;default:node.setAttribute(attrFix[attr]||attr,value);}}}return node;},getComputedStyle:function(element,styleName){return utils.transUnitToPx(utils.fixColor(styleName,$(element).css(styleName)));},preventDefault:function(evt){evt.preventDefault?evt.preventDefault():(evt.returnValue=false);},getStyle:function(element,name){var value=element.style[utils.cssStyleToDomStyle(name)];return utils.fixColor(name,value);},setStyle:function(element,name,value){element.style[utils.cssStyleToDomStyle(name)]=value;if(!utils.trim(element.style.cssText)){this.removeAttributes(element,"style");}},removeDirtyAttr:function(node){for(var i=0,ci,nodes=node.getElementsByTagName("*");ci=nodes[i++];){ci.removeAttribute("_moz_dirty");}node.removeAttribute("_moz_dirty");},getChildCount:function(node,fn){var count=0,first=node.firstChild;fn=fn||function(){return 1;};while(first){if(fn(first)){count++;}first=first.nextSibling;}return count;},isEmptyNode:function(node){return !node.firstChild||domUtils.getChildCount(node,function(node){return !domUtils.isBr(node)&&!domUtils.isBookmarkNode(node)&&!domUtils.isWhitespace(node);})==0;},isBr:function(node){return node.nodeType==1&&node.tagName=="BR";},isFillChar:function(node,isInStart){return node.nodeType==3&&!node.nodeValue.replace(new RegExp((isInStart?"^":"")+domUtils.fillChar),"").length;},isEmptyBlock:function(node,reg){if(node.nodeType!=1){return 0;}reg=reg||new RegExp("[ \t\r\n"+domUtils.fillChar+"]","g");if(node[browser.ie?"innerText":"textContent"].replace(reg,"").length>0){return 0;}for(var n in dtd.$isNotEmpty){if(node.getElementsByTagName(n).length){return 0;}}return 1;},isCustomeNode:function(node){return node.nodeType==1&&node.getAttribute("_ue_custom_node_");},fillNode:function(doc,node){var tmpNode=browser.ie?doc.createTextNode(domUtils.fillChar):doc.createElement("br");node.innerHTML="";node.appendChild(tmpNode);},isBoundaryNode:function(node,dir){var tmp;while(!domUtils.isBody(node)){tmp=node;node=node.parentNode;if(tmp!==node[dir]){return false;}}return true;},isFillChar:function(node,isInStart){return node.nodeType==3&&!node.nodeValue.replace(new RegExp((isInStart?"^":"")+domUtils.fillChar),"").length;}};var fillCharReg=new RegExp(domUtils.fillChar,"g");(function(){var guid=0,fillChar=domUtils.fillChar,fillData;function updateCollapse(range){range.collapsed=range.startContainer&&range.endContainer&&range.startContainer===range.endContainer&&range.startOffset==range.endOffset;}function selectOneNode(rng){return !rng.collapsed&&rng.startContainer.nodeType==1&&rng.startContainer===rng.endContainer&&rng.endOffset-rng.startOffset==1;}function setEndPoint(toStart,node,offset,range){if(node.nodeType==1&&(dtd.$empty[node.tagName]||dtd.$nonChild[node.tagName])){offset=domUtils.getNodeIndex(node)+(toStart?0:1);node=node.parentNode;}if(toStart){range.startContainer=node;range.startOffset=offset;if(!range.endContainer){range.collapse(true);}}else{range.endContainer=node;range.endOffset=offset;if(!range.startContainer){range.collapse(false);}}updateCollapse(range);return range;}var Range=dom.Range=function(document,body){var me=this;me.startContainer=me.startOffset=me.endContainer=me.endOffset=null;me.document=document;me.collapsed=true;me.body=body;};function removeFillData(doc,excludeNode){try{if(fillData&&domUtils.inDoc(fillData,doc)){if(!fillData.nodeValue.replace(fillCharReg,"").length){var tmpNode=fillData.parentNode;domUtils.remove(fillData);while(tmpNode&&domUtils.isEmptyInlineElement(tmpNode)&&(browser.safari?!(domUtils.getPosition(tmpNode,excludeNode)&domUtils.POSITION_CONTAINS):!tmpNode.contains(excludeNode))){fillData=tmpNode.parentNode;domUtils.remove(tmpNode);tmpNode=fillData;}}else{fillData.nodeValue=fillData.nodeValue.replace(fillCharReg,"");}}}catch(e){}}function mergeSibling(node,dir){var tmpNode;node=node[dir];while(node&&domUtils.isFillChar(node)){tmpNode=node[dir];domUtils.remove(node);node=tmpNode;}}Range.prototype={inFillChar:function(){var start=this.startContainer;if(this.collapsed&&start.nodeType==3&&start.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==start.nodeValue.length){return true;}return false;},setStart:function(node,offset){return setEndPoint(true,node,offset,this);},setEnd:function(node,offset){return setEndPoint(false,node,offset,this);},setStartAfter:function(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node)+1);},setStartBefore:function(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node));},setEndAfter:function(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node)+1);},setEndBefore:function(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node));},setStartAtFirst:function(node){return this.setStart(node,0);},setStartAtLast:function(node){return this.setStart(node,node.nodeType==3?node.nodeValue.length:node.childNodes.length);},setEndAtFirst:function(node){return this.setEnd(node,0);},setEndAtLast:function(node){return this.setEnd(node,node.nodeType==3?node.nodeValue.length:node.childNodes.length);},selectNode:function(node){return this.setStartBefore(node).setEndAfter(node);},selectNodeContents:function(node){return this.setStart(node,0).setEndAtLast(node);},cloneRange:function(){var me=this;return new Range(me.document).setStart(me.startContainer,me.startOffset).setEnd(me.endContainer,me.endOffset);},collapse:function(toStart){var me=this;if(toStart){me.endContainer=me.startContainer;me.endOffset=me.startOffset;}else{me.startContainer=me.endContainer;me.startOffset=me.endOffset;}me.collapsed=true;return me;},shrinkBoundary:function(ignoreEnd){var me=this,child,collapsed=me.collapsed;function check(node){return node.nodeType==1&&!domUtils.isBookmarkNode(node)&&!dtd.$empty[node.tagName]&&!dtd.$nonChild[node.tagName];}while(me.startContainer.nodeType==1&&(child=me.startContainer.childNodes[me.startOffset])&&check(child)){me.setStart(child,0);}if(collapsed){return me.collapse(true);}if(!ignoreEnd){while(me.endContainer.nodeType==1&&me.endOffset>0&&(child=me.endContainer.childNodes[me.endOffset-1])&&check(child)){me.setEnd(child,child.childNodes.length);}}return me;},trimBoundary:function(ignoreEnd){this.txtToElmBoundary();var start=this.startContainer,offset=this.startOffset,collapsed=this.collapsed,end=this.endContainer;if(start.nodeType==3){if(offset==0){this.setStartBefore(start);}else{if(offset>=start.nodeValue.length){this.setStartAfter(start);}else{var textNode=domUtils.split(start,offset);if(start===end){this.setEnd(textNode,this.endOffset-offset);}else{if(start.parentNode===end){this.endOffset+=1;}}this.setStartBefore(textNode);}}if(collapsed){return this.collapse(true);}}if(!ignoreEnd){offset=this.endOffset;end=this.endContainer;if(end.nodeType==3){if(offset==0){this.setEndBefore(end);}else{offset<end.nodeValue.length&&domUtils.split(end,offset);this.setEndAfter(end);}}}return this;},txtToElmBoundary:function(ignoreCollapsed){function adjust(r,c){var container=r[c+"Container"],offset=r[c+"Offset"];if(container.nodeType==3){if(!offset){r["set"+c.replace(/(\w)/,function(a){return a.toUpperCase();})+"Before"](container);}else{if(offset>=container.nodeValue.length){r["set"+c.replace(/(\w)/,function(a){return a.toUpperCase();})+"After"](container);}}}}if(ignoreCollapsed||!this.collapsed){adjust(this,"start");adjust(this,"end");}return this;},insertNode:function(node){var first=node,length=1;if(node.nodeType==11){first=node.firstChild;length=node.childNodes.length;}this.trimBoundary(true);var start=this.startContainer,offset=this.startOffset;var nextNode=start.childNodes[offset];if(nextNode){start.insertBefore(node,nextNode);}else{start.appendChild(node);}if(first.parentNode===this.endContainer){this.endOffset=this.endOffset+length;}return this.setStartBefore(first);},setCursor:function(toEnd,noFillData){return this.collapse(!toEnd).select(noFillData);},createBookmark:function(serialize,same){var endNode,startNode=this.document.createElement("span");startNode.style.cssText="display:none;line-height:0px;";startNode.appendChild(this.document.createTextNode("\u200D"));startNode.id="_baidu_bookmark_start_"+(same?"":guid++);if(!this.collapsed){endNode=startNode.cloneNode(true);endNode.id="_baidu_bookmark_end_"+(same?"":guid++);}this.insertNode(startNode);if(endNode){this.collapse().insertNode(endNode).setEndBefore(endNode);}this.setStartAfter(startNode);return{start:serialize?startNode.id:startNode,end:endNode?serialize?endNode.id:endNode:null,id:serialize};},moveToBookmark:function(bookmark){var start=bookmark.id?this.document.getElementById(bookmark.start):bookmark.start,end=bookmark.end&&bookmark.id?this.document.getElementById(bookmark.end):bookmark.end;this.setStartBefore(start);domUtils.remove(start);if(end){this.setEndBefore(end);domUtils.remove(end);}else{this.collapse(true);}return this;},adjustmentBoundary:function(){if(!this.collapsed){while(!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length&&this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setStartAfter(this.startContainer);}while(!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[this.endContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setEndBefore(this.endContainer);}}return this;},getClosedNode:function(){var node;if(!this.collapsed){var range=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(selectOneNode(range)){var child=range.startContainer.childNodes[range.startOffset];if(child&&child.nodeType==1&&(dtd.$empty[child.tagName]||dtd.$nonChild[child.tagName])){node=child;}}}return node;},select:browser.ie?function(noFillData,textRange){var nativeRange;if(!this.collapsed){this.shrinkBoundary();}var node=this.getClosedNode();if(node&&!textRange){try{nativeRange=this.document.body.createControlRange();nativeRange.addElement(node);nativeRange.select();}catch(e){}return this;}var bookmark=this.createBookmark(),start=bookmark.start,end;nativeRange=this.document.body.createTextRange();nativeRange.moveToElementText(start);nativeRange.moveStart("character",1);if(!this.collapsed){var nativeRangeEnd=this.document.body.createTextRange();end=bookmark.end;nativeRangeEnd.moveToElementText(end);nativeRange.setEndPoint("EndToEnd",nativeRangeEnd);}else{if(!noFillData&&this.startContainer.nodeType!=3){var tmpText=this.document.createTextNode(fillChar),tmp=this.document.createElement("span");tmp.appendChild(this.document.createTextNode(fillChar));start.parentNode.insertBefore(tmp,start);start.parentNode.insertBefore(tmpText,start);removeFillData(this.document,tmpText);fillData=tmpText;mergeSibling(tmp,"previousSibling");mergeSibling(start,"nextSibling");nativeRange.moveStart("character",-1);nativeRange.collapse(true);}}this.moveToBookmark(bookmark);tmp&&domUtils.remove(tmp);try{nativeRange.select();}catch(e){}return this;}:function(notInsertFillData){function checkOffset(rng){function check(node,offset,dir){if(node.nodeType==3&&node.nodeValue.length<offset){rng[dir+"Offset"]=node.nodeValue.length;}}check(rng.startContainer,rng.startOffset,"start");check(rng.endContainer,rng.endOffset,"end");}var win=domUtils.getWindow(this.document),sel=win.getSelection(),txtNode;browser.gecko?this.document.body.focus():win.focus();if(sel){sel.removeAllRanges();if(this.collapsed&&!notInsertFillData){var start=this.startContainer,child=start;if(start.nodeType==1){child=start.childNodes[this.startOffset];}if(!(start.nodeType==3&&this.startOffset)&&(child?(!child.previousSibling||child.previousSibling.nodeType!=3):(!start.lastChild||start.lastChild.nodeType!=3))){txtNode=this.document.createTextNode(fillChar);this.insertNode(txtNode);removeFillData(this.document,txtNode);mergeSibling(txtNode,"previousSibling");mergeSibling(txtNode,"nextSibling");fillData=txtNode;this.setStart(txtNode,browser.webkit?1:0).collapse(true);}}var nativeRange=this.document.createRange();if(this.collapsed&&browser.opera&&this.startContainer.nodeType==1){var child=this.startContainer.childNodes[this.startOffset];if(!child){child=this.startContainer.lastChild;if(child&&domUtils.isBr(child)){this.setStartBefore(child).collapse(true);}}else{while(child&&domUtils.isBlockElm(child)){if(child.nodeType==1&&child.childNodes[0]){child=child.childNodes[0];}else{break;}}child&&this.setStartBefore(child).collapse(true);}}checkOffset(this);nativeRange.setStart(this.startContainer,this.startOffset);nativeRange.setEnd(this.endContainer,this.endOffset);sel.addRange(nativeRange);}return this;},scrollToView:function(win,offset){win=win?window:domUtils.getWindow(this.document);var me=this,span=me.document.createElement("span");span.innerHTML="&nbsp;";me.cloneRange().insertNode(span);domUtils.scrollToView(span,win,offset);domUtils.remove(span);return me;},createAddress:function(ignoreEnd,ignoreTxt){var addr={},me=this;function getAddress(isStart){var node=isStart?me.startContainer:me.endContainer;var parents=domUtils.findParents(node,true,function(node){return !domUtils.isBody(node);}),addrs=[];for(var i=0,ci;ci=parents[i++];){addrs.push(domUtils.getNodeIndex(ci,ignoreTxt));}var firstIndex=0;if(ignoreTxt){if(node.nodeType==3){var tmpNode=node.previousSibling;while(tmpNode&&tmpNode.nodeType==3){firstIndex+=tmpNode.nodeValue.replace(fillCharReg,"").length;tmpNode=tmpNode.previousSibling;}firstIndex+=(isStart?me.startOffset:me.endOffset);}else{node=node.childNodes[isStart?me.startOffset:me.endOffset];if(node){firstIndex=domUtils.getNodeIndex(node,ignoreTxt);}else{node=isStart?me.startContainer:me.endContainer;var first=node.firstChild;while(first){if(domUtils.isFillChar(first)){first=first.nextSibling;continue;}firstIndex++;if(first.nodeType==3){while(first&&first.nodeType==3){first=first.nextSibling;}}else{first=first.nextSibling;}}}}}else{firstIndex=isStart?domUtils.isFillChar(node)?0:me.startOffset:me.endOffset;}if(firstIndex<0){firstIndex=0;}addrs.push(firstIndex);return addrs;}addr.startAddress=getAddress(true);if(!ignoreEnd){addr.endAddress=me.collapsed?[].concat(addr.startAddress):getAddress();}return addr;},moveToAddress:function(addr,ignoreEnd){var me=this;function getNode(address,isStart){var tmpNode=me.body,parentNode,offset;for(var i=0,ci,l=address.length;i<l;i++){ci=address[i];parentNode=tmpNode;tmpNode=tmpNode.childNodes[ci];if(!tmpNode){offset=ci;break;}}if(isStart){if(tmpNode){me.setStartBefore(tmpNode);}else{me.setStart(parentNode,offset);}}else{if(tmpNode){me.setEndBefore(tmpNode);}else{me.setEnd(parentNode,offset);}}}getNode(addr.startAddress,true);!ignoreEnd&&addr.endAddress&&getNode(addr.endAddress);return me;},equals:function(rng){for(var p in this){if(this.hasOwnProperty(p)){if(this[p]!==rng[p]){return false;}}}return true;},scrollIntoView:function(){var $span=$('<span style="padding:0;margin:0;display:block;border:0">&nbsp;</span>');this.cloneRange().insertNode($span.get(0));var winScrollTop=$(window).scrollTop(),winHeight=$(window).height(),spanTop=$span.offset().top;if(spanTop<winScrollTop||spanTop>winScrollTop+winHeight){if(spanTop>winScrollTop+winHeight){window.scrollTo(0,spanTop-winHeight+$span.height());}else{window.scrollTo(0,winScrollTop-spanTop);}}$span.remove();}};})();(function(){function getBoundaryInformation(range,start){var getIndex=domUtils.getNodeIndex;range=range.duplicate();range.collapse(start);var parent=range.parentElement();if(!parent.hasChildNodes()){return{container:parent,offset:0};}var siblings=parent.children,child,testRange=range.duplicate(),startIndex=0,endIndex=siblings.length-1,index=-1,distance;while(startIndex<=endIndex){index=Math.floor((startIndex+endIndex)/2);child=siblings[index];testRange.moveToElementText(child);var position=testRange.compareEndPoints("StartToStart",range);if(position>0){endIndex=index-1;}else{if(position<0){startIndex=index+1;}else{return{container:parent,offset:getIndex(child)};}}}if(index==-1){testRange.moveToElementText(parent);testRange.setEndPoint("StartToStart",range);distance=testRange.text.replace(/(\r\n|\r)/g,"\n").length;siblings=parent.childNodes;if(!distance){child=siblings[siblings.length-1];return{container:child,offset:child.nodeValue.length};}var i=siblings.length;while(distance>0){distance-=siblings[--i].nodeValue.length;}return{container:siblings[i],offset:-distance};}testRange.collapse(position>0);testRange.setEndPoint(position>0?"StartToStart":"EndToStart",range);distance=testRange.text.replace(/(\r\n|\r)/g,"\n").length;if(!distance){return dtd.$empty[child.tagName]||dtd.$nonChild[child.tagName]?{container:parent,offset:getIndex(child)+(position>0?0:1)}:{container:child,offset:position>0?0:child.childNodes.length};}while(distance>0){try{var pre=child;child=child[position>0?"previousSibling":"nextSibling"];distance-=child.nodeValue.length;}catch(e){return{container:parent,offset:getIndex(pre)};}}return{container:child,offset:position>0?-distance:child.nodeValue.length+distance};}function transformIERangeToRange(ieRange,range){if(ieRange.item){range.selectNode(ieRange.item(0));}else{var bi=getBoundaryInformation(ieRange,true);range.setStart(bi.container,bi.offset);if(ieRange.compareEndPoints("StartToEnd",ieRange)!=0){bi=getBoundaryInformation(ieRange,false);range.setEnd(bi.container,bi.offset);}}return range;}function _getIERange(sel,txtRange){var ieRange;try{ieRange=sel.getNative(txtRange).createRange();}catch(e){return null;}var el=ieRange.item?ieRange.item(0):ieRange.parentElement();if((el.ownerDocument||el)===sel.document){return ieRange;}return null;}var Selection=dom.Selection=function(doc,body){var me=this;me.document=doc;me.body=body;if(browser.ie9below){domUtils.on(body,"beforedeactivate",function(){me._bakIERange=me.getIERange();});domUtils.on(body,"activate",function(){try{var ieNativRng=_getIERange(me);if((!ieNativRng||!me.rangeInBody(ieNativRng))&&me._bakIERange){me._bakIERange.select();}}catch(ex){}me._bakIERange=null;});}};Selection.prototype={hasNativeRange:function(){if(!browser.ie||browser.ie9above){var sel=this.getNative();return sel.rangeCount;}else{var ieRange=_getIERange(this);return ieRange&&this.rangeInBody(ieRange);}},getNative:function(txtRange){var doc=this.document;try{return !doc?null:browser.ie9below||txtRange?doc.selection:domUtils.getWindow(doc).getSelection();}catch(e){return null;}},getIERange:function(txtRange){var ieRange=_getIERange(this,txtRange);if(!ieRange||!this.rangeInBody(ieRange,txtRange)){if(this._bakIERange){return this._bakIERange;}}return ieRange;},rangeInBody:function(rng,txtRange){var node=browser.ie9below||txtRange?rng.item?rng.item():rng.parentElement():rng.startContainer;return node===this.body||domUtils.inDoc(node,this.body);},cache:function(){this.clear();this._cachedRange=this.getRange();this._cachedStartElement=this.getStart();this._cachedStartElementPath=this.getStartElementPath();},getStartElementPath:function(){if(this._cachedStartElementPath){return this._cachedStartElementPath;}var start=this.getStart();if(start){return domUtils.findParents(start,true,null,true);}return[];},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null;},isFocus:function(){try{return browser.ie&&_getIERange(this)||!browser.ie&&this.getNative().rangeCount?true:false;}catch(e){return false;}},getRange:function(){var me=this;function optimze(range){var child=me.body.firstChild,collapsed=range.collapsed;while(child&&child.firstChild){range.setStart(child,0);child=child.firstChild;}if(!range.startContainer){range.setStart(me.body,0);}if(collapsed){range.collapse(true);}}if(me._cachedRange!=null){return this._cachedRange;}var range=new dom.Range(me.document);if(browser.ie9below){var nativeRange=me.getIERange();if(nativeRange){try{transformIERangeToRange(nativeRange,range);}catch(e){optimze(range);}}else{optimze(range);}}else{var sel=me.getNative();if(sel&&sel.rangeCount&&me.rangeInBody(sel.getRangeAt(0))){var firstRange=sel.getRangeAt(0);var lastRange=sel.getRangeAt(sel.rangeCount-1);range.setStart(firstRange.startContainer,firstRange.startOffset).setEnd(lastRange.endContainer,lastRange.endOffset);if(range.collapsed&&domUtils.isBody(range.startContainer)&&!range.startOffset){optimze(range);}}else{if(this._bakRange&&domUtils.inDoc(this._bakRange.startContainer,this.document)){return this._bakRange;}optimze(range);}}return this._bakRange=range;},getStart:function(){if(this._cachedStartElement){return this._cachedStartElement;}var range=browser.ie9below?this.getIERange():this.getRange(),tmpRange,start,tmp,parent;if(browser.ie9below){if(!range){return this.document.body.firstChild;}if(range.item){return range.item(0);}tmpRange=range.duplicate();tmpRange.text.length>0&&tmpRange.moveStart("character",1);tmpRange.collapse(1);start=tmpRange.parentElement();parent=tmp=range.parentElement();while(tmp=tmp.parentNode){if(tmp==start){start=parent;break;}}}else{start=range.startContainer;if(start.nodeType==1&&start.hasChildNodes()){start=start.childNodes[Math.min(start.childNodes.length-1,range.startOffset)];}if(start.nodeType==3){return start.parentNode;}}return start;},getText:function(){var nativeSel,nativeRange;if(this.isFocus()&&(nativeSel=this.getNative())){nativeRange=browser.ie9below?nativeSel.createRange():nativeSel.getRangeAt(0);return browser.ie9below?nativeRange.text:nativeRange.toString();}return"";}};})();(function(){var uid=0,_selectionChangeTimer;function setValue(form,editor){var textarea;if(editor.textarea){if(utils.isString(editor.textarea)){for(var i=0,ti,tis=domUtils.getElementsByTagName(form,"textarea");ti=tis[i++];){if(ti.id=="ueditor_textarea_"+editor.options.textarea){textarea=ti;break;}}}else{textarea=editor.textarea;}}if(!textarea){form.appendChild(textarea=domUtils.createElement(document,"textarea",{"name":editor.options.textarea,"id":"ueditor_textarea_"+editor.options.textarea,"style":"display:none"}));editor.textarea=textarea;}textarea.value=editor.hasContents()?(editor.options.allHtmlEnabled?editor.getAllHtml():editor.getContent(null,null,true)):"";}function loadPlugins(me){for(var pi in UE.plugins){UE.plugins[pi].call(me);}me.langIsReady=true;me.fireEvent("langReady");}function checkCurLang(I18N){for(var lang in I18N){return lang;}}var Editor=UE.Editor=function(options){var me=this;me.uid=uid++;EventBase.call(me);me.commands={};me.options=utils.extend(utils.clone(options||{}),UEDITOR_CONFIG,true);me.shortcutkeys={};me.inputRules=[];me.outputRules=[];me.setOpt({isShow:true,initialContent:"",initialStyle:".edui-editor-body .edui-body-container p{margin:5px 0;} "+".edui-editor-body .edui-body-container{border:0;outline:none;cursor:text;padding:0 5px 0;word-wrap:break-word;font-size:16px;font-family:sans-serif;}"+".edui-editor-body.focus{border:1px solid #5c9dff}",autoClearinitialContent:false,iframeCssUrl:me.options.UEDITOR_HOME_URL+"themes/iframe.css",textarea:"editorValue",focus:false,focusInEnd:true,autoClearEmptyNode:true,fullscreen:false,readonly:false,zIndex:999,imagePopup:true,enterTag:"p",customDomain:false,lang:"zh-cn",langPath:me.options.UEDITOR_HOME_URL+"lang/",theme:"default",themePath:me.options.UEDITOR_HOME_URL+"themes/",allHtmlEnabled:false,scaleEnabled:false,tableNativeEditInFF:false,autoSyncData:true});if(!utils.isEmptyObject(UE.I18N)){me.options.lang=checkCurLang(UE.I18N);loadPlugins(me);}else{utils.loadFile(document,{src:me.options.langPath+me.options.lang+"/"+me.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){loadPlugins(me);});}UE.instants["ueditorInstant"+me.uid]=me;};Editor.prototype={ready:function(fn){var me=this;if(fn){me.isReady?fn.apply(me):me.addListener("ready",fn);}},setOpt:function(key,val){var obj={};if(utils.isString(key)){obj[key]=val;}else{obj=key;}utils.extend(this.options,obj,true);},getOpt:function(key){return this.options[key]||"";},destroy:function(){var me=this;me.fireEvent("destroy");var container=me.container.parentNode;var textarea=me.textarea;if(!textarea){textarea=document.createElement("textarea");container.parentNode.insertBefore(textarea,container);}else{textarea.style.display="";}textarea.style.width=me.body.offsetWidth+"px";textarea.style.height=me.body.offsetHeight+"px";textarea.value=me.getContent();textarea.id=me.key;container.innerHTML="";domUtils.remove(container);var key=me.key;for(var p in me){if(me.hasOwnProperty(p)){delete this[p];}}UE.delEditor(key);},initialCont:function(holder){if(holder){holder.getAttribute("name")&&(this.options.textarea=holder.getAttribute("name"));if(holder&&/script|textarea/ig.test(holder.tagName)){var newDiv=document.createElement("div");holder.parentNode.insertBefore(newDiv,holder);this.options.initialContent=UE.htmlparser(holder.value||holder.innerHTML||this.options.initialContent).toHtml();holder.className&&(newDiv.className=holder.className);holder.style.cssText&&(newDiv.style.cssText=holder.style.cssText);if(/textarea/i.test(holder.tagName)){this.textarea=holder;this.textarea.style.display="none";}else{holder.parentNode.removeChild(holder);holder.id&&(newDiv.id=holder.id);}holder=newDiv;holder.innerHTML="";}return holder;}else{return null;}},render:function(container){var me=this,options=me.options,getStyleValue=function(attr){return parseInt($(container).css(attr));};if(utils.isString(container)){container=document.getElementById(container);}if(container){utils.cssRule("ueditor_body_css",me.options.initialStyle,document);container=this.initialCont(container);container.className+=" edui-body-container";if(options.initialFrameWidth){options.minFrameWidth=options.initialFrameWidth;}else{options.minFrameWidth=options.initialFrameWidth=container.offsetWidth;}if(options.initialFrameHeight){options.minFrameHeight=options.initialFrameHeight;}else{options.initialFrameHeight=options.minFrameHeight=container.offsetHeight;}container.style.width=/%$/.test(options.initialFrameWidth)?"100%":options.initialFrameWidth-getStyleValue("padding-left")-getStyleValue("padding-right")+"px";var height=/%$/.test(options.initialFrameHeight)?"100%":(options.initialFrameHeight-getStyleValue("padding-top")-getStyleValue("padding-bottom"));container.style.minHeight=height+"px";container.style.height="";container.style.zIndex=options.zIndex;if(browser.ie&&browser.version<=6){container.style.height=height;container.style.setExpression("height","this.scrollHeight <= "+height+' ? "'+height+'px" : "auto"');}this._setup(container);}},_setup:function(cont){var me=this,options=me.options;cont.contentEditable=true;document.body.spellcheck=false;me.document=document;me.window=document.defaultView||document.parentWindow;me.body=cont;me.$body=$(cont);domUtils.isBody=function(node){return node===cont;};me.selection=new dom.Selection(document,me.body);var geckoSel;if(browser.gecko&&(geckoSel=this.selection.getNative())){geckoSel.removeAllRanges();}this._initEvents();for(var form=cont.parentNode;form&&!domUtils.isBody(form);form=form.parentNode){if(form.tagName=="FORM"){me.form=form;if(me.options.autoSyncData){domUtils.on(cont,"blur",function(){setValue(form,me);});}else{domUtils.on(form,"submit",function(){setValue(this,me);});}break;}}if(options.initialContent){if(options.autoClearinitialContent){var oldExecCommand=me.execCommand;me.execCommand=function(){me.fireEvent("firstBeforeExecCommand");return oldExecCommand.apply(me,arguments);};this._setDefaultContent(options.initialContent);}else{this.setContent(options.initialContent,false,true);}}if(domUtils.isEmptyNode(me.body)){me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";}if(options.focus){setTimeout(function(){me.focus(me.options.focusInEnd);!me.options.autoClearinitialContent&&me._selectionChange();},0);}if(!me.container){me.container=cont.parentNode;}me._bindshortcutKeys();me.isReady=1;me.fireEvent("ready");options.onready&&options.onready.call(me);if(!browser.ie||browser.ie9above){domUtils.on(me.body,["blur","focus"],function(e){if(e.type=="blur"){me._bakRange=me.selection.getRange();}else{try{me._bakRange&&me._bakRange.select();}catch(e){}me._bakRange=null;}});}!options.isShow&&me.setHide();options.readonly&&me.setDisabled();},sync:function(formId){var me=this,form=formId?document.getElementById(formId):domUtils.findParent(me.iframe.parentNode,function(node){return node.tagName=="FORM";},true);form&&setValue(form,me);},setHeight:function(height,notSetHeight){!notSetHeight&&(this.options.initialFrameHeight=height);this.body.style.height=height+"px";},addshortcutkey:function(cmd,keys){var obj={};if(keys){obj[cmd]=keys;}else{obj=cmd;}utils.extend(this.shortcutkeys,obj);},_bindshortcutKeys:function(){var me=this,shortcutkeys=this.shortcutkeys;me.addListener("keydown",function(type,e){var keyCode=e.keyCode||e.which;for(var i in shortcutkeys){var tmp=shortcutkeys[i].split(",");for(var t=0,ti;ti=tmp[t++];){ti=ti.split(":");var key=ti[0],param=ti[1];if(/^(ctrl)(\+shift)?\+(\d+)$/.test(key.toLowerCase())||/^(\d+)$/.test(key)){if(((RegExp.$1=="ctrl"?(e.ctrlKey||e.metaKey):0)&&(RegExp.$2!=""?e[RegExp.$2.slice(1)+"Key"]:1)&&keyCode==RegExp.$3)||keyCode==RegExp.$1){if(me.queryCommandState(i,param)!=-1){me.execCommand(i,param);}domUtils.preventDefault(e);}}}}});},getContent:function(cmd,fn,notSetCursor,ignoreBlank,formatter){var me=this;if(cmd&&utils.isFunction(cmd)){fn=cmd;cmd="";}if(fn?!fn():!this.hasContents()){return"";}me.fireEvent("beforegetcontent");var root=UE.htmlparser(me.body.innerHTML,ignoreBlank);me.filterOutputRule(root);me.fireEvent("aftergetcontent",cmd);return root.toHtml(formatter);},getAllHtml:function(){var me=this,headHtml=[],html="";me.fireEvent("getAllHtml",headHtml);if(browser.ie&&browser.version>8){var headHtmlForIE9="";utils.each(me.document.styleSheets,function(si){headHtmlForIE9+=(si.href?'<link rel="stylesheet" type="text/css" href="'+si.href+'" />':"<style>"+si.cssText+"</style>");});utils.each(me.document.getElementsByTagName("script"),function(si){headHtmlForIE9+=si.outerHTML;});}return"<html><head>"+(me.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+me.options.charset+'"/>':"")+(headHtmlForIE9||me.document.getElementsByTagName("head")[0].innerHTML)+headHtml.join("\n")+"</head>"+"<body "+(ie&&browser.version<9?'class="view"':"")+">"+me.getContent(null,null,true)+"</body></html>";},getPlainTxt:function(){var reg=new RegExp(domUtils.fillChar,"g"),html=this.body.innerHTML.replace(/[\n\r]/g,"");html=html.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(a,b,c){return dtd.$block[c]?"\n":b?b:"";});return html.replace(reg,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ");},getContentTxt:function(){var reg=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(reg,"").replace(/\u00a0/g," ");},setContent:function(html,isAppendTo,notFireSelectionchange){var me=this;me.fireEvent("beforesetcontent",html);var root=UE.htmlparser(html);me.filterInputRule(root);html=root.toHtml();me.body.innerHTML=(isAppendTo?me.body.innerHTML:"")+html;function isCdataDiv(node){return node.tagName=="DIV"&&node.getAttribute("cdata_tag");}if(me.options.enterTag=="p"){var child=this.body.firstChild,tmpNode;if(!child||child.nodeType==1&&(dtd.$cdata[child.tagName]||isCdataDiv(child)||domUtils.isCustomeNode(child))&&child===this.body.lastChild){this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;}else{var p=me.document.createElement("p");while(child){while(child&&(child.nodeType==3||child.nodeType==1&&dtd.p[child.tagName]&&!dtd.$cdata[child.tagName])){tmpNode=child.nextSibling;p.appendChild(child);child=tmpNode;}if(p.firstChild){if(!child){me.body.appendChild(p);break;}else{child.parentNode.insertBefore(p,child);p=me.document.createElement("p");}}child=child.nextSibling;}}}me.fireEvent("aftersetcontent");me.fireEvent("contentchange");!notFireSelectionchange&&me._selectionChange();me._bakRange=me._bakIERange=me._bakNativeRange=null;var geckoSel;if(browser.gecko&&(geckoSel=this.selection.getNative())){geckoSel.removeAllRanges();}if(me.options.autoSyncData){me.form&&setValue(me.form,me);}},focus:function(toEnd){try{var me=this,rng=me.selection.getRange();if(toEnd){rng.setStartAtLast(me.body.lastChild).setCursor(false,true);}else{rng.select(true);}this.fireEvent("focus");}catch(e){}},_initEvents:function(){var me=this,cont=me.body;me._proxyDomEvent=utils.bind(me._proxyDomEvent,me);domUtils.on(cont,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],me._proxyDomEvent);domUtils.on(cont,["focus","blur"],me._proxyDomEvent);domUtils.on(cont,["mouseup","keydown"],function(evt){if(evt.type=="keydown"&&(evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey)){return;}if(evt.button==2){return;}me._selectionChange(250,evt);});},_proxyDomEvent:function(evt){return this.fireEvent(evt.type.replace(/^on/,""),evt);},_selectionChange:function(delay,evt){var me=this;var hackForMouseUp=false;var mouseX,mouseY;if(browser.ie&&browser.version<9&&evt&&evt.type=="mouseup"){var range=this.selection.getRange();if(!range.collapsed){hackForMouseUp=true;mouseX=evt.clientX;mouseY=evt.clientY;}}clearTimeout(_selectionChangeTimer);_selectionChangeTimer=setTimeout(function(){if(!me.selection.getNative()){return;}var ieRange;if(hackForMouseUp&&me.selection.getNative().type=="None"){ieRange=me.document.body.createTextRange();try{ieRange.moveToPoint(mouseX,mouseY);}catch(ex){ieRange=null;}}var bakGetIERange;if(ieRange){bakGetIERange=me.selection.getIERange;me.selection.getIERange=function(){return ieRange;};}me.selection.cache();if(bakGetIERange){me.selection.getIERange=bakGetIERange;}if(me.selection._cachedRange&&me.selection._cachedStartElement){me.fireEvent("beforeselectionchange");me.fireEvent("selectionchange",!!evt);me.fireEvent("afterselectionchange");me.selection.clear();}},delay||50);},_callCmdFn:function(fnName,args){args=Array.prototype.slice.call(args,0);var cmdName=args.shift().toLowerCase(),cmd,cmdFn;cmd=this.commands[cmdName]||UE.commands[cmdName];cmdFn=cmd&&cmd[fnName];if((!cmd||!cmdFn)&&fnName=="queryCommandState"){return 0;}else{if(cmdFn){return cmdFn.apply(this,[cmdName].concat(args));}}},execCommand:function(cmdName){if(!this.selection.hasNativeRange()){this.focus(true);}cmdName=cmdName.toLowerCase();var me=this,result,cmd=me.commands[cmdName]||UE.commands[cmdName];if(!cmd||!cmd.execCommand){return null;}if(!cmd.notNeedUndo&&!me.__hasEnterExecCommand){me.__hasEnterExecCommand=true;if(me.queryCommandState.apply(me,arguments)!=-1){me.fireEvent("beforeexeccommand",cmdName);result=this._callCmdFn("execCommand",arguments);!me._ignoreContentChange&&me.fireEvent("contentchange");me.fireEvent("afterexeccommand",cmdName);}me.__hasEnterExecCommand=false;}else{result=this._callCmdFn("execCommand",arguments);!me._ignoreContentChange&&me.fireEvent("contentchange");}!me._ignoreContentChange&&me._selectionChange();return result;},queryCommandState:function(cmdName){return this._callCmdFn("queryCommandState",arguments);},queryCommandValue:function(cmdName){return this._callCmdFn("queryCommandValue",arguments);},hasContents:function(tags){if(tags){for(var i=0,ci;ci=tags[i++];){if(this.document.getElementsByTagName(ci).length>0){return true;}}}if(!domUtils.isEmptyBlock(this.body)){return true;}tags=["div"];for(i=0;ci=tags[i++];){var nodes=domUtils.getElementsByTagName(this.document,ci);for(var n=0,cn;cn=nodes[n++];){if(domUtils.isCustomeNode(cn)){return true;}}}return false;},reset:function(){this.fireEvent("reset");},setEnabled:function(){var me=this,range;if(me.body.contentEditable=="false"){me.body.contentEditable=true;range=me.selection.getRange();try{range.moveToBookmark(me.lastBk);delete me.lastBk;}catch(e){range.setStartAtFirst(me.body).collapse(true);}range.select(true);if(me.bkqueryCommandState){me.queryCommandState=me.bkqueryCommandState;delete me.bkqueryCommandState;}me.fireEvent("selectionchange");}},enable:function(){return this.setEnabled();},setDisabled:function(except){var me=this;except=except?utils.isArray(except)?except:[except]:[];if(me.body.contentEditable=="true"){if(!me.lastBk){me.lastBk=me.selection.getRange().createBookmark(true);}me.body.contentEditable=false;me.bkqueryCommandState=me.queryCommandState;me.queryCommandState=function(type){if(utils.indexOf(except,type)!=-1){return me.bkqueryCommandState.apply(me,arguments);}return -1;};me.fireEvent("selectionchange");}},disable:function(except){return this.setDisabled(except);},_setDefaultContent:function(){function clear(){var me=this;if(me.document.getElementById("initContent")){me.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>";me.removeListener("firstBeforeExecCommand focus",clear);setTimeout(function(){me.focus();me._selectionChange();},0);}}return function(cont){var me=this;me.body.innerHTML='<p id="initContent">'+cont+"</p>";me.addListener("firstBeforeExecCommand focus",clear);};}(),setShow:function(){var me=this,range=me.selection.getRange();if(me.container.style.display=="none"){try{range.moveToBookmark(me.lastBk);delete me.lastBk;}catch(e){range.setStartAtFirst(me.body).collapse(true);}setTimeout(function(){range.select(true);},100);me.container.style.display="";}},show:function(){return this.setShow();},setHide:function(){var me=this;if(!me.lastBk){me.lastBk=me.selection.getRange().createBookmark(true);}me.container.style.display="none";},hide:function(){return this.setHide();},getLang:function(path){var lang=UE.I18N[this.options.lang];if(!lang){throw Error("not import language file");}path=(path||"").split(".");for(var i=0,ci;ci=path[i++];){lang=lang[ci];if(!lang){break;}}return lang;},getContentLength:function(ingoneHtml,tagNames){var count=this.getContent(false,false,true).length;if(ingoneHtml){tagNames=(tagNames||[]).concat(["hr","img","iframe"]);count=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var i=0,ci;ci=tagNames[i++];){count+=this.document.getElementsByTagName(ci).length;}}return count;},addInputRule:function(rule){this.inputRules.push(rule);},filterInputRule:function(root){for(var i=0,ci;ci=this.inputRules[i++];){ci.call(this,root);}},addOutputRule:function(rule){this.outputRules.push(rule);},filterOutputRule:function(root){for(var i=0,ci;ci=this.outputRules[i++];){ci.call(this,root);}}};utils.inherits(Editor,EventBase);})();var filterWord=UE.filterWord=function(){function isWordDocument(str){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<v:)/ig.test(str);}function transUnit(v){v=v.replace(/[\d.]+\w+/g,function(m){return utils.transUnitToPx(m);});return v;}function filterPasteWord(str){return str.replace(/[\t\r\n]+/g,"").replace(/<!--[\s\S]*?-->/ig,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(str){if(browser.opera){return"";}try{var width=str.match(/width:([ \d.]*p[tx])/i)[1],height=str.match(/height:([ \d.]*p[tx])/i)[1],src=str.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+transUnit(width)+'" height="'+transUnit(height)+'" src="'+src+'" />';}catch(e){return"";}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/ig,function(str,name,marks,val){return name=="class"&&val=="MsoListParagraph"?str:"";}).replace(/<(font|span)[^>]*>\s*<\/\1>/gi,"").replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(str,tag,tmp,style){var n=[],s=style.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g);for(var i=0,v;v=s[i];i++){var name,value,parts=v.split(":");if(parts.length==2){name=parts[0].toLowerCase();value=parts[1].toLowerCase();if(/^(background)\w*/.test(name)&&value.replace(/(initial|\s)/g,"").length==0||/^(margin)\w*/.test(name)&&/^0\w+$/.test(value)){continue;}switch(name){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":if(!/<table/.test(tag)){n[i]=name.replace(/^mso-|-alt$/g,"")+":"+transUnit(value);}continue;case"horiz-align":n[i]="text-align:"+value;continue;case"vert-align":n[i]="vertical-align:"+value;continue;case"font-color":case"mso-foreground":n[i]="color:"+value;continue;case"mso-background":case"mso-highlight":n[i]="background:"+value;continue;case"mso-default-height":n[i]="min-height:"+transUnit(value);continue;case"mso-default-width":n[i]="min-width:"+transUnit(value);continue;case"mso-padding-between-alt":n[i]="border-collapse:separate;border-spacing:"+transUnit(value);continue;case"text-line-through":if((value=="single")||(value=="double")){n[i]="text-decoration:line-through";}continue;case"mso-zero-height":if(value=="yes"){n[i]="display:none";}continue;case"background":break;case"margin":if(!/[1-9]/.test(value)){continue;}}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(name)||/text\-indent|padding|margin/.test(name)&&/\-[\d.]+/.test(value)){continue;}n[i]=name+":"+parts[1];}}return tag+(n.length?' style="'+n.join(";").replace(/;{2,}/g,";")+'"':"");}).replace(/[\d.]+(cm|pt)/g,function(str){return utils.transUnitToPx(str);});}return function(html){return(isWordDocument(html)?filterPasteWord(html):html);};}();(function(){var uNode=UE.uNode=function(obj){this.type=obj.type;this.data=obj.data;this.tagName=obj.tagName;this.parentNode=obj.parentNode;this.attrs=obj.attrs||{};this.children=obj.children;};var indentChar="    ",breakChar="\n";function insertLine(arr,current,begin){arr.push(breakChar);return current+(begin?1:-1);}function insertIndent(arr,current){for(var i=0;i<current;i++){arr.push(indentChar);}}uNode.createElement=function(html){if(/[<>]/.test(html)){return UE.htmlparser(html).children[0];}else{return new uNode({type:"element",children:[],tagName:html});}};uNode.createText=function(data){return new UE.uNode({type:"text","data":utils.unhtml(data||"")});};function nodeToHtml(node,arr,formatter,current){switch(node.type){case"root":for(var i=0,ci;ci=node.children[i++];){if(formatter&&ci.type=="element"&&!dtd.$inlineWithA[ci.tagName]&&i>1){insertLine(arr,current,true);insertIndent(arr,current);}nodeToHtml(ci,arr,formatter,current);}break;case"text":isText(node,arr);break;case"element":isElement(node,arr,formatter,current);break;case"comment":isComment(node,arr,formatter);}return arr;}function isText(node,arr){arr.push(node.parentNode.tagName=="pre"?node.data:node.data.replace(/[ ]{2}/g," &nbsp;"));}function isElement(node,arr,formatter,current){var attrhtml="";if(node.attrs){attrhtml=[];var attrs=node.attrs;for(var a in attrs){attrhtml.push(a+(attrs[a]!==undefined?'="'+utils.unhtml(attrs[a])+'"':""));}attrhtml=attrhtml.join(" ");}arr.push("<"+node.tagName+(attrhtml?" "+attrhtml:"")+(dtd.$empty[node.tagName]?"/":"")+">");if(formatter&&!dtd.$inlineWithA[node.tagName]&&node.tagName!="pre"){if(node.children&&node.children.length){current=insertLine(arr,current,true);insertIndent(arr,current);}}if(node.children&&node.children.length){for(var i=0,ci;ci=node.children[i++];){if(formatter&&ci.type=="element"&&!dtd.$inlineWithA[ci.tagName]&&i>1){insertLine(arr,current);insertIndent(arr,current);}nodeToHtml(ci,arr,formatter,current);}}if(!dtd.$empty[node.tagName]){if(formatter&&!dtd.$inlineWithA[node.tagName]&&node.tagName!="pre"){if(node.children&&node.children.length){current=insertLine(arr,current);insertIndent(arr,current);}}arr.push("</"+node.tagName+">");}}function isComment(node,arr){arr.push("<!--"+node.data+"-->");}function getNodeById(root,id){var node;if(root.type=="element"&&root.getAttr("id")==id){return root;}if(root.children&&root.children.length){for(var i=0,ci;ci=root.children[i++];){if(node=getNodeById(ci,id)){return node;}}}}function getNodesByTagName(node,tagName,arr){if(node.type=="element"&&node.tagName==tagName){arr.push(node);}if(node.children&&node.children.length){for(var i=0,ci;ci=node.children[i++];){getNodesByTagName(ci,tagName,arr);}}}function nodeTraversal(root,fn){if(root.children&&root.children.length){for(var i=0,ci;ci=root.children[i];){nodeTraversal(ci,fn);if(ci.parentNode){if(ci.children&&ci.children.length){fn(ci);}if(ci.parentNode){i++;}}}}else{fn(root);}}uNode.prototype={toHtml:function(formatter){var arr=[];nodeToHtml(this,arr,formatter,0);return arr.join("");},innerHTML:function(htmlstr){if(this.type!="element"||dtd.$empty[this.tagName]){return this;}if(utils.isString(htmlstr)){if(this.children){for(var i=0,ci;ci=this.children[i++];){ci.parentNode=null;}}this.children=[];var tmpRoot=UE.htmlparser(htmlstr);for(var i=0,ci;ci=tmpRoot.children[i++];){this.children.push(ci);ci.parentNode=this;}return this;}else{var tmpRoot=new UE.uNode({type:"root",children:this.children});return tmpRoot.toHtml();}},innerText:function(textStr){if(this.type!="element"||dtd.$empty[this.tagName]){return this;}if(textStr){if(this.children){for(var i=0,ci;ci=this.children[i++];){ci.parentNode=null;}}this.children=[];this.appendChild(uNode.createText(textStr));return this;}else{return this.toHtml().replace(/<[^>]+>/g,"");}},getData:function(){if(this.type=="element"){return"";}return this.data;},firstChild:function(){return this.children?this.children[0]:null;},lastChild:function(){return this.children?this.children[this.children.length-1]:null;},previousSibling:function(){var parent=this.parentNode;for(var i=0,ci;ci=parent.children[i];i++){if(ci===this){return i==0?null:parent.children[i-1];}}},nextSibling:function(){var parent=this.parentNode;for(var i=0,ci;ci=parent.children[i++];){if(ci===this){return parent.children[i];}}},replaceChild:function(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target);}for(var i=0,ci;ci=this.children[i];i++){if(ci===source){this.children.splice(i,1,target);source.parentNode=null;target.parentNode=this;return target;}}}},appendChild:function(node){if(this.type=="root"||(this.type=="element"&&!dtd.$empty[this.tagName])){if(!this.children){this.children=[];}if(node.parentNode){node.parentNode.removeChild(node);}for(var i=0,ci;ci=this.children[i];i++){if(ci===node){this.children.splice(i,1);break;}}this.children.push(node);node.parentNode=this;return node;}},insertBefore:function(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target);}for(var i=0,ci;ci=this.children[i];i++){if(ci===source){this.children.splice(i,0,target);target.parentNode=this;return target;}}}},insertAfter:function(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target);}for(var i=0,ci;ci=this.children[i];i++){if(ci===source){this.children.splice(i+1,0,target);target.parentNode=this;return target;}}}},removeChild:function(node,keepChildren){if(this.children){for(var i=0,ci;ci=this.children[i];i++){if(ci===node){this.children.splice(i,1);ci.parentNode=null;if(keepChildren&&ci.children&&ci.children.length){for(var j=0,cj;cj=ci.children[j];j++){this.children.splice(i+j,0,cj);cj.parentNode=this;}}return ci;}}}},getAttr:function(attrName){return this.attrs&&this.attrs[attrName.toLowerCase()];},setAttr:function(attrName,attrVal){if(!attrName){delete this.attrs;return;}if(!this.attrs){this.attrs={};}if(utils.isObject(attrName)){for(var a in attrName){if(!attrName[a]){delete this.attrs[a];}else{this.attrs[a.toLowerCase()]=attrName[a];}}}else{if(!attrVal){delete this.attrs[attrName];}else{this.attrs[attrName.toLowerCase()]=attrVal;}}},getIndex:function(){var parent=this.parentNode;for(var i=0,ci;ci=parent.children[i];i++){if(ci===this){return i;}}return -1;},getNodeById:function(id){var node;if(this.children&&this.children.length){for(var i=0,ci;ci=this.children[i++];){if(node=getNodeById(ci,id)){return node;}}}},getNodesByTagName:function(tagNames){tagNames=utils.trim(tagNames).replace(/[ ]{2,}/g," ").split(" ");var arr=[],me=this;utils.each(tagNames,function(tagName){if(me.children&&me.children.length){for(var i=0,ci;ci=me.children[i++];){getNodesByTagName(ci,tagName,arr);}}});return arr;},getStyle:function(name){var cssStyle=this.getAttr("style");if(!cssStyle){return"";}var reg=new RegExp(name+":([^;]+)","i");var match=cssStyle.match(reg);if(match&&match[0]){return match[1];}return"";},setStyle:function(name,val){function exec(name,val){var reg=new RegExp(name+":([^;]+;?)","gi");cssStyle=cssStyle.replace(reg,"");if(val){cssStyle=name+":"+utils.unhtml(val)+";"+cssStyle;}}var cssStyle=this.getAttr("style");if(!cssStyle){cssStyle="";}if(utils.isObject(name)){for(var a in name){exec(a,name[a]);}}else{exec(name,val);}this.setAttr("style",utils.trim(cssStyle));},traversal:function(fn){if(this.children&&this.children.length){nodeTraversal(this,fn);}return this;}};})();var htmlparser=UE.htmlparser=function(htmlstr,ignoreBlank){var re_tag=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,re_attr=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g;var allowEmptyTags={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};htmlstr=htmlstr.replace(new RegExp(domUtils.fillChar,"g"),"");if(!ignoreBlank){htmlstr=htmlstr.replace(new RegExp("[\\r\\t\\n"+(ignoreBlank?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(ignoreBlank?"":" ")+"]*","g"),function(a,b){if(b&&allowEmptyTags[b.toLowerCase()]){return a.replace(/(^[\n\r]+)|([\n\r]+$)/g,"");}return a.replace(new RegExp("^[\\r\\n"+(ignoreBlank?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(ignoreBlank?"":" ")+"]+$"),"");});}var uNode=UE.uNode,needParentNode={"td":"tr","tr":["tbody","thead","tfoot"],"tbody":"table","th":"tr","thead":"table","tfoot":"table","caption":"table","li":["ul","ol"],"dt":"dl","dd":"dl","option":"select"},needChild={"ol":"li","ul":"li"};function text(parent,data){if(needChild[parent.tagName]){var tmpNode=uNode.createElement(needChild[parent.tagName]);parent.appendChild(tmpNode);tmpNode.appendChild(uNode.createText(data));parent=tmpNode;}else{parent.appendChild(uNode.createText(data));}}function element(parent,tagName,htmlattr){var needParentTag;if(needParentTag=needParentNode[tagName]){var tmpParent=parent,hasParent;while(tmpParent.type!="root"){if(utils.isArray(needParentTag)?utils.indexOf(needParentTag,tmpParent.tagName)!=-1:needParentTag==tmpParent.tagName){parent=tmpParent;hasParent=true;break;}tmpParent=tmpParent.parentNode;}if(!hasParent){parent=element(parent,utils.isArray(needParentTag)?needParentTag[0]:needParentTag);}}var elm=new uNode({parentNode:parent,type:"element",tagName:tagName.toLowerCase(),children:dtd.$empty[tagName]?null:[]});if(htmlattr){var attrs={},match;while(match=re_attr.exec(htmlattr)){attrs[match[1].toLowerCase()]=utils.unhtml(match[2]||match[3]||match[4]);}elm.attrs=attrs;}parent.children.push(elm);return dtd.$empty[tagName]?parent:elm;}function comment(parent,data){parent.children.push(new uNode({type:"comment",data:data,parentNode:parent}));}var match,currentIndex=0,nextIndex=0;var root=new uNode({type:"root",children:[]});var currentParent=root;while(match=re_tag.exec(htmlstr)){currentIndex=match.index;try{if(currentIndex>nextIndex){text(currentParent,htmlstr.slice(nextIndex,currentIndex));}if(match[3]){currentParent=element(currentParent,match[3].toLowerCase(),match[4]);}else{if(match[1]){if(currentParent.type!="root"){var tmpParent=currentParent;while(currentParent.type=="element"&&currentParent.tagName!=match[1].toLowerCase()){currentParent=currentParent.parentNode;if(currentParent.type=="root"){currentParent=tmpParent;throw"break";}}currentParent=currentParent.parentNode;}}else{if(match[2]){comment(currentParent,match[2]);}}}}catch(e){}nextIndex=re_tag.lastIndex;}if(nextIndex<htmlstr.length){text(currentParent,htmlstr.slice(nextIndex));}return root;};var filterNode=UE.filterNode=function(){function filterNode(node,rules){switch(node.type){case"text":break;case"element":var val;if(val=rules[node.tagName]){if(val==="-"){node.parentNode.removeChild(node);}else{if(utils.isFunction(val)){var parentNode=node.parentNode,index=node.getIndex();val(node);if(node.parentNode){if(node.children){for(var i=0,ci;ci=node.children[i];){filterNode(ci,rules);if(ci.parentNode){i++;}}}}else{for(var i=index,ci;ci=parentNode.children[i];){filterNode(ci,rules);if(ci.parentNode){i++;}}}}else{var attrs=val["$"];if(attrs&&node.attrs){var tmpAttrs={},tmpVal;for(var a in attrs){tmpVal=node.getAttr(a);if(a=="style"&&utils.isArray(attrs[a])){var tmpCssStyle=[];utils.each(attrs[a],function(v){var tmp;if(tmp=node.getStyle(v)){tmpCssStyle.push(v+":"+tmp);}});tmpVal=tmpCssStyle.join(";");}if(tmpVal){tmpAttrs[a]=tmpVal;}}node.attrs=tmpAttrs;}if(node.children){for(var i=0,ci;ci=node.children[i];){filterNode(ci,rules);if(ci.parentNode){i++;}}}}}}else{if(dtd.$cdata[node.tagName]){node.parentNode.removeChild(node);}else{var parentNode=node.parentNode,index=node.getIndex();node.parentNode.removeChild(node,true);for(var i=index,ci;ci=parentNode.children[i];){filterNode(ci,rules);if(ci.parentNode){i++;}}}}break;case"comment":node.parentNode.removeChild(node);}}return function(root,rules){if(utils.isEmptyObject(rules)){return root;}var val;if(val=rules["-"]){utils.each(val.split(" "),function(k){rules[k]="-";});}for(var i=0,ci;ci=root.children[i];){filterNode(ci,rules);if(ci.parentNode){i++;}}return root;};}();UE.commands["inserthtml"]={execCommand:function(command,html,notNeedFilter){var me=this;if(!html){return;}if(me.fireEvent("beforeinserthtml",html)===true){return;}if(!notNeedFilter){var root=UE.htmlparser(html);if(me.options.filterRules){UE.filterNode(root,me.options.filterRules);}me.filterInputRule(root);html=root.toHtml();}var rng=me.selection.getRange();rng.select();if(browser.ie){var nRng=me.selection.getIERange(true);html+='<span id="_ue_tmp_cursor_node">&nbsp;</span>';nRng.pasteHTML(html);var $tmp=$("#_ue_tmp_cursor_node",me.body);new dom.Range(document,me.body).setStartBefore($tmp[0]).collapse(true).select();$tmp.remove();}else{me.document.execCommand("insertHTML",false,html);}setTimeout(function(){me.fireEvent("afterinserthtml");setTimeout(function(){me.selection.getRange().scrollIntoView();},50);},50);}};UE.commands["insertimage"]={execCommand:function(cmd,opt){opt=utils.isArray(opt)?opt:[opt];if(!opt.length){return;}var me=this;var html=[],str="",ci;ci=opt[0];if(opt.length==1){str='<img src="'+ci.src+'" '+(ci._src?' _src="'+ci._src+'" ':"")+(ci.width?'width="'+ci.width+'" ':"")+(ci.height?' height="'+ci.height+'" ':"")+(ci["floatStyle"]=="left"||ci["floatStyle"]=="right"?' style="float:'+ci["floatStyle"]+';"':"")+(ci.title&&ci.title!=""?' title="'+ci.title+'"':"")+(ci.border&&ci.border!="0"?' border="'+ci.border+'"':"")+(ci.alt&&ci.alt!=""?' alt="'+ci.alt+'"':"")+(ci.hspace&&ci.hspace!="0"?' hspace = "'+ci.hspace+'"':"")+(ci.vspace&&ci.vspace!="0"?' vspace = "'+ci.vspace+'"':"")+"/>";if(ci["floatStyle"]=="center"){str='<p style="text-align: center">'+str+"</p>";}html.push(str);}else{for(var i=0;ci=opt[i++];){str="<p "+(ci["floatStyle"]=="center"?'style="text-align: center" ':"")+'><img src="'+ci.src+'" '+(ci.width?'width="'+ci.width+'" ':"")+(ci._src?' _src="'+ci._src+'" ':"")+(ci.height?' height="'+ci.height+'" ':"")+' style="'+(ci["floatStyle"]&&ci["floatStyle"]!="center"?"float:"+ci["floatStyle"]+";":"")+(ci.border||"")+'" '+(ci.title?' title="'+ci.title+'"':"")+" /></p>";html.push(str);}}me.execCommand("insertHtml",html.join(""),true);}};UE.plugins["justify"]=function(){$.each("justifyleft justifyright justifycenter justifyfull".split(" "),function(i,cmdName){UE.commands[cmdName]={execCommand:function(cmdName){return this.document.execCommand(cmdName);},queryCommandValue:function(cmdName){return this.document.queryCommandValue(cmdName)==="true"?cmdName.replace(/justify/):"";},queryCommandState:function(cmdName){return this.document.queryCommandState(cmdName)?1:0;}};});};UE.plugins["font"]=function(){var me=this,fonts={"forecolor":"forecolor","backcolor":"backcolor","fontsize":"fontsize","fontfamily":"fontname"};me.setOpt({"fontfamily":[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"},{name:"sans-serif",val:"sans-serif"}],"fontsize":[10,12,16,18,24,32,48]});var fontsize={"10":"1","12":"2","16":"3","18":"4","24":"5","32":"6","48":"7"};me.addOutputRule(function(root){utils.each(root.getNodesByTagName("font"),function(node){if(node.tagName=="font"){var cssStyle=[];for(var p in node.attrs){switch(p){case"size":var val=node.attrs[p];$.each(fontsize,function(k,v){if(v==val){val=k;return false;}});cssStyle.push("font-size:"+val+"px");break;case"color":cssStyle.push("color:"+node.attrs[p]);break;case"face":cssStyle.push("font-family:"+node.attrs[p]);break;case"style":cssStyle.push(node.attrs[p]);}}node.attrs={"style":cssStyle.join(";")};}node.tagName="span";});});for(var p in fonts){(function(cmd){UE.commands[cmd]={execCommand:function(cmdName,value){if(cmdName=="fontsize"){value=fontsize[value.replace(/px/,"")];}return this.document.execCommand(fonts[cmdName],false,value);},queryCommandValue:function(cmdName){if(cmdName=="fontfamily"){var startNode=this.selection.getStart();var val=$(startNode).css("fontFamily");}else{var val=this.document.queryCommandValue(fonts[cmdName]);if(cmdName=="fontsize"){$.each(fontsize,function(k,v){if(v==val){val=k;return false;}});}}return val;},queryCommandState:function(cmdName){return this.document.queryCommandState(fonts[cmdName]);}};})(p);}};UE.plugins["link"]=function(){UE.commands["link"]={execCommand:function(cmdName,opt){var me=this;me.document.execCommand("createlink",false,"_ueditor_link");utils.each(domUtils.getElementsByTagName(me.body,"a",function(n){return n.getAttribute("href")=="_ueditor_link";}),function(l){domUtils.setAttributes(l,opt);});}};UE.commands["unlink"]={execCommand:function(){this.document.execCommand("unlink");}};};UE.commands["print"]={execCommand:function(){this.window.print();},notNeedUndo:1};UE.plugins["paragraph"]=function(){var me=this;me.setOpt("paragraph",{"p":"","h1":"","h2":"","h3":"","h4":"","h5":"","h6":""});me.commands["paragraph"]={execCommand:function(cmdName,style){return this.document.execCommand("formatBlock",false,"<"+style+">");},queryCommandValue:function(){return this.document.queryCommandValue("formatBlock");}};};UE.plugins["horizontal"]=function(){var me=this;me.commands["horizontal"]={execCommand:function(){this.document.execCommand("insertHorizontalRule");}};};UE.commands["cleardoc"]={execCommand:function(){var me=this,range=me.selection.getRange();me.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>";range.setStart(me.body.firstChild,0).setCursor(false,true);setTimeout(function(){me.fireEvent("clearDoc");},0);}};UE.plugins["undo"]=function(){var saveSceneTimer;var me=this,maxUndoCount=me.options.maxUndoCount||20,maxInputCount=me.options.maxInputCount||20,fillchar=new RegExp(domUtils.fillChar+"|</hr>","gi");var noNeedFillCharTags={ol:1,ul:1,table:1,tbody:1,tr:1,body:1};var orgState=me.options.autoClearEmptyNode;function compareAddr(indexA,indexB){if(indexA.length!=indexB.length){return 0;}for(var i=0,l=indexA.length;i<l;i++){if(indexA[i]!=indexB[i]){return 0;}}return 1;}function compareRangeAddress(rngAddrA,rngAddrB){if(rngAddrA.collapsed!=rngAddrB.collapsed){return 0;}if(!compareAddr(rngAddrA.startAddress,rngAddrB.startAddress)||!compareAddr(rngAddrA.endAddress,rngAddrB.endAddress)){return 0;}return 1;}function UndoManager(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&this.list.length==1){this.reset();return;}while(this.list[this.index].content==this.list[this.index-1].content){this.index--;if(this.index==0){return this.restore(0);}}this.restore(--this.index);}};this.redo=function(){if(this.hasRedo){while(this.list[this.index].content==this.list[this.index+1].content){this.index++;if(this.index==this.list.length-1){return this.restore(this.index);}}this.restore(++this.index);}};this.restore=function(){var me=this.editor;var scene=this.list[this.index];var root=UE.htmlparser(scene.content.replace(fillchar,""));me.options.autoClearEmptyNode=false;me.filterInputRule(root);me.options.autoClearEmptyNode=orgState;me.body.innerHTML=root.toHtml();me.fireEvent("afterscencerestore");if(browser.ie){utils.each(domUtils.getElementsByTagName(me.document,"td th caption p"),function(node){if(domUtils.isEmptyNode(node)){domUtils.fillNode(me.document,node);}});}try{var rng=new dom.Range(me.document,me.body).moveToAddress(scene.address);rng.select(noNeedFillCharTags[rng.startContainer.nodeName.toLowerCase()]);}catch(e){}this.update();this.clearKey();me.fireEvent("reset",true);};this.getScene=function(notSetCursor){var me=this.editor;var rng=me.selection.getRange(),rngAddress=rng.createAddress(false,true);me.fireEvent("beforegetscene");var root=UE.htmlparser(me.body.innerHTML,true);me.options.autoClearEmptyNode=false;me.filterOutputRule(root);me.options.autoClearEmptyNode=orgState;var cont=root.toHtml();browser.ie&&(cont=cont.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">"));me.fireEvent("aftergetscene");try{}catch(e){}return{address:rngAddress,content:cont};};this.save=function(notCompareRange,notSetCursor){clearTimeout(saveSceneTimer);var currentScene=this.getScene(notSetCursor),lastScene=this.list[this.index];if(lastScene&&lastScene.content==currentScene.content&&(notCompareRange?1:compareRangeAddress(lastScene.address,currentScene.address))){return;}this.list=this.list.slice(0,this.index+1);this.list.push(currentScene);if(this.list.length>maxUndoCount){this.list.shift();}this.index=this.list.length-1;this.clearKey();this.update();};this.update=function(){this.hasRedo=!!this.list[this.index+1];this.hasUndo=!!this.list[this.index-1];};this.reset=function(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.clearKey();};this.clearKey=function(){keycont=0;lastKeyCode=null;};}me.undoManger=new UndoManager();me.undoManger.editor=me;function saveScene(){this.undoManger.save();}me.addListener("saveScene",function(){var args=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,args);});me.addListener("beforeexeccommand",saveScene);me.addListener("afterexeccommand",saveScene);me.addListener("reset",function(type,exclude){if(!exclude){this.undoManger.reset();}});me.commands["redo"]=me.commands["undo"]={execCommand:function(cmdName){this.undoManger[cmdName]();},queryCommandState:function(cmdName){return this.undoManger["has"+(cmdName.toLowerCase()=="undo"?"Undo":"Redo")]?0:-1;},notNeedUndo:1};var keys={16:1,17:1,18:1,37:1,38:1,39:1,40:1},keycont=0,lastKeyCode;var inputType=false;me.addListener("ready",function(){domUtils.on(this.body,"compositionstart",function(){inputType=true;});domUtils.on(this.body,"compositionend",function(){inputType=false;});});me.addshortcutkey({"Undo":"ctrl+90","Redo":"ctrl+89,shift+ctrl+z"});var isCollapsed=true;me.addListener("keydown",function(type,evt){var me=this;var keyCode=evt.keyCode||evt.which;if(!keys[keyCode]&&!evt.ctrlKey&&!evt.metaKey&&!evt.shiftKey&&!evt.altKey){if(inputType){return;}if(!me.selection.getRange().collapsed){me.undoManger.save(false,true);isCollapsed=false;return;}if(me.undoManger.list.length==0){me.undoManger.save(true);}clearTimeout(saveSceneTimer);function save(cont){if(cont.selection.getRange().collapsed){cont.fireEvent("contentchange");}cont.undoManger.save(false,true);cont.fireEvent("selectionchange");}saveSceneTimer=setTimeout(function(){if(inputType){var interalTimer=setInterval(function(){if(!inputType){save(me);clearInterval(interalTimer);}},300);return;}save(me);},200);lastKeyCode=keyCode;keycont++;if(keycont>=maxInputCount){save(me);}}});me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;if(!keys[keyCode]&&!evt.ctrlKey&&!evt.metaKey&&!evt.shiftKey&&!evt.altKey){if(inputType){return;}if(!isCollapsed){this.undoManger.save(false,true);isCollapsed=true;}}});};UE.plugins["paste"]=function(){function getClipboardData(callback){var doc=this.document;if(doc.getElementById("baidu_pastebin")){return;}var range=this.selection.getRange(),bk=range.createBookmark(),pastebin=doc.createElement("div");pastebin.id="baidu_pastebin";browser.webkit&&pastebin.appendChild(doc.createTextNode(domUtils.fillChar+domUtils.fillChar));this.body.appendChild(pastebin);bk.start.style.display="";pastebin.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+domUtils.getXY(bk.start).y+"px";range.selectNodeContents(pastebin).select(true);setTimeout(function(){if(browser.webkit){for(var i=0,pastebins=doc.querySelectorAll("#baidu_pastebin"),pi;pi=pastebins[i++];){if(domUtils.isEmptyNode(pi)){domUtils.remove(pi);}else{pastebin=pi;break;}}}try{pastebin.parentNode.removeChild(pastebin);}catch(e){}range.moveToBookmark(bk).select(true);callback(pastebin);},0);}var me=this;function filter(div){var html;if(div.firstChild){var nodes=domUtils.getElementsByTagName(div,"span");for(var i=0,ni;ni=nodes[i++];){if(ni.id=="_baidu_cut_start"||ni.id=="_baidu_cut_end"){domUtils.remove(ni);}}if(browser.webkit){var brs=div.querySelectorAll("div br");for(var i=0,bi;bi=brs[i++];){var pN=bi.parentNode;if(pN.tagName=="DIV"&&pN.childNodes.length==1){pN.innerHTML="<p><br/></p>";domUtils.remove(pN);}}var divs=div.querySelectorAll("#baidu_pastebin");for(var i=0,di;di=divs[i++];){var tmpP=me.document.createElement("p");di.parentNode.insertBefore(tmpP,di);while(di.firstChild){tmpP.appendChild(di.firstChild);}domUtils.remove(di);}var metas=div.querySelectorAll("meta");for(var i=0,ci;ci=metas[i++];){domUtils.remove(ci);}var brs=div.querySelectorAll("br");for(i=0;ci=brs[i++];){if(/^apple-/i.test(ci.className)){domUtils.remove(ci);}}}if(browser.gecko){var dirtyNodes=div.querySelectorAll("[_moz_dirty]");for(i=0;ci=dirtyNodes[i++];){ci.removeAttribute("_moz_dirty");}}if(!browser.ie){var spans=div.querySelectorAll("span.Apple-style-span");for(var i=0,ci;ci=spans[i++];){domUtils.remove(ci,true);}}html=div.innerHTML;html=UE.filterWord(html);var root=UE.htmlparser(html);if(me.options.filterRules){UE.filterNode(root,me.options.filterRules);}me.filterInputRule(root);if(browser.webkit){var br=root.lastChild();if(br&&br.type=="element"&&br.tagName=="br"){root.removeChild(br);}utils.each(me.body.querySelectorAll("div"),function(node){if(domUtils.isEmptyBlock(node)){domUtils.remove(node);}});}html={"html":root.toHtml()};me.fireEvent("beforepaste",html,root);if(!html.html){return;}me.execCommand("insertHtml",html.html,true);me.fireEvent("afterpaste",html);}}me.addListener("ready",function(){domUtils.on(me.body,"cut",function(){var range=me.selection.getRange();if(!range.collapsed&&me.undoManger){me.undoManger.save();}});domUtils.on(me.body,browser.ie||browser.opera?"keydown":"paste",function(e){if((browser.ie||browser.opera)&&((!e.ctrlKey&&!e.metaKey)||e.keyCode!="86")){return;}getClipboardData.call(me,function(div){filter(div);});});});};UE.plugins["list"]=function(){var me=this;me.setOpt({"insertorderedlist":{"decimal":"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},"insertunorderedlist":{"circle":"","disc":"","square":""}});me.commands["insertorderedlist"]=me.commands["insertunorderedlist"]={execCommand:function(cmdName){return this.document.execCommand(cmdName);},queryCommandState:function(cmdName){return this.document.queryCommandState(cmdName);}};};(function(){var sourceEditors={textarea:function(editor,holder){var textarea=holder.ownerDocument.createElement("textarea");textarea.style.cssText="resize:none;border:0;padding:0 5px;margin:0;overflow-y:auto;outline:0";if(browser.ie&&browser.version<8){textarea.style.width=holder.offsetWidth+"px";textarea.style.height=holder.offsetHeight+"px";holder.onresize=function(){textarea.style.width=holder.offsetWidth+"px";textarea.style.height=holder.offsetHeight+"px";};}holder.appendChild(textarea);return{container:textarea,setContent:function(content){textarea.value=content;},getContent:function(){return textarea.value;},select:function(){var range;if(browser.ie){range=textarea.createTextRange();range.collapse(true);range.select();}else{textarea.setSelectionRange(0,0);textarea.focus();}},dispose:function(){holder.removeChild(textarea);holder.onresize=null;textarea=null;holder=null;}};}};UE.plugins["source"]=function(){var me=this;var opt=this.options;var sourceMode=false;var sourceEditor;opt.sourceEditor="textarea";me.setOpt({sourceEditorFirst:false});function createSourceEditor(holder){return sourceEditors.textarea(me,holder);}var bakCssText;var oldGetContent=me.getContent,bakAddress;me.commands["source"]={execCommand:function(){sourceMode=!sourceMode;if(sourceMode){bakAddress=me.selection.getRange().createAddress(false,true);me.undoManger&&me.undoManger.save(true);if(browser.gecko){me.body.contentEditable=false;}me.body.style.cssText+=";position:absolute;left:-32768px;top:-32768px;";me.fireEvent("beforegetcontent");var root=UE.htmlparser(me.body.innerHTML);me.filterOutputRule(root);root.traversal(function(node){if(node.type=="element"){switch(node.tagName){case"td":case"th":case"caption":if(node.children&&node.children.length==1){if(node.firstChild().tagName=="br"){node.removeChild(node.firstChild());}}break;case"pre":node.innerText(node.innerText().replace(/&nbsp;/g," "));}}});me.fireEvent("aftergetcontent");var content=root.toHtml(true);sourceEditor=createSourceEditor(me.body.parentNode);sourceEditor.setContent(content);$(sourceEditor.container).width($(me.body).width()).height($(me.body).height());setTimeout(function(){sourceEditor.select();});me.getContent=function(){return sourceEditor.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";};}else{me.$body.css({"position":"","left":"","top":""});var cont=sourceEditor.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";cont=cont.replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(a,b){if(b&&!dtd.$inlineWithA[b.toLowerCase()]){return a.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,"");}return a.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"");});me.setContent(cont);sourceEditor.dispose();sourceEditor=null;me.getContent=oldGetContent;var first=me.body.firstChild;if(!first){me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";first=me.body.firstChild;}me.undoManger&&me.undoManger.save(true);if(browser.gecko){var input=document.createElement("input");input.style.cssText="position:absolute;left:0;top:-32768px";document.body.appendChild(input);me.body.contentEditable=false;setTimeout(function(){domUtils.setViewportOffset(input,{left:-32768,top:0});input.focus();setTimeout(function(){me.body.contentEditable=true;me.selection.getRange().moveToAddress(bakAddress).select(true);domUtils.remove(input);});});}else{try{me.selection.getRange().moveToAddress(bakAddress).select(true);}catch(e){}}}this.fireEvent("sourcemodechanged",sourceMode);},queryCommandState:function(){return sourceMode|0;},notNeedUndo:1};var oldQueryCommandState=me.queryCommandState;me.queryCommandState=function(cmdName){cmdName=cmdName.toLowerCase();if(sourceMode){return cmdName in {"source":1,"fullscreen":1}?oldQueryCommandState.apply(this,arguments):-1;}return oldQueryCommandState.apply(this,arguments);};};})();UE.plugins["enterkey"]=function(){var hTag,me=this,tag=me.options.enterTag;me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;if(keyCode==13){var range=me.selection.getRange(),start=range.startContainer,doSave;if(!browser.ie){if(/h\d/i.test(hTag)){if(browser.gecko){var h=domUtils.findParentByTagName(start,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],true);if(!h){me.document.execCommand("formatBlock",false,"<p>");doSave=1;}}else{if(start.nodeType==1){var tmp=me.document.createTextNode(""),div;range.insertNode(tmp);div=domUtils.findParentByTagName(tmp,"div",true);if(div){var p=me.document.createElement("p");while(div.firstChild){p.appendChild(div.firstChild);}div.parentNode.insertBefore(p,div);domUtils.remove(div);range.setStartBefore(tmp).setCursor();doSave=1;}domUtils.remove(tmp);}}if(me.undoManger&&doSave){me.undoManger.save();}}browser.opera&&range.select();}else{me.fireEvent("saveScene",true,true);}}});me.addListener("keydown",function(type,evt){var keyCode=evt.keyCode||evt.which;if(keyCode==13){if(me.fireEvent("beforeenterkeydown")){domUtils.preventDefault(evt);return;}me.fireEvent("saveScene",true,true);hTag="";var range=me.selection.getRange();if(!range.collapsed){var start=range.startContainer,end=range.endContainer,startTd=domUtils.findParentByTagName(start,"td",true),endTd=domUtils.findParentByTagName(end,"td",true);if(startTd&&endTd&&startTd!==endTd||!startTd&&endTd||startTd&&!endTd){evt.preventDefault?evt.preventDefault():(evt.returnValue=false);return;}}if(tag=="p"){if(!browser.ie){start=domUtils.findParentByTagName(range.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],true);if(!start&&!browser.opera){me.document.execCommand("formatBlock",false,"<p>");if(browser.gecko){range=me.selection.getRange();start=domUtils.findParentByTagName(range.startContainer,"p",true);start&&domUtils.removeDirtyAttr(start);}}else{hTag=start.tagName;start.tagName.toLowerCase()=="p"&&browser.gecko&&domUtils.removeDirtyAttr(start);}}}}});};UE.commands["preview"]={execCommand:function(){var w=window.open("","_blank",""),d=w.document;d.open();d.write('<html><head><script src="'+this.options.UEDITOR_HOME_URL+'ueditor.parse.js"><\/script><script>'+"setTimeout(function(){uParse('div',{"+"    'highlightJsUrl':'"+this.options.UEDITOR_HOME_URL+"third-party/SyntaxHighlighter/shCore.js',"+"    'highlightCssUrl':'"+this.options.UEDITOR_HOME_URL+"third-party/SyntaxHighlighter/shCoreDefault.css'"+"})},300)"+"<\/script></head><body><div>"+this.getContent(null,null,true)+"</div></body></html>");d.close();},notNeedUndo:1};UE.plugins["basestyle"]=function(){var basestyles=["bold","underline","superscript","subscript","italic","strikethrough"],me=this;me.addshortcutkey({"Bold":"ctrl+66","Italic":"ctrl+73","Underline":"ctrl+shift+85","strikeThrough":"ctrl+shift+83"});me.addOutputRule(function(root){$.each(root.getNodesByTagName("b i u strike s"),function(i,node){switch(node.tagName){case"b":node.tagName="strong";break;case"i":node.tagName="em";break;case"u":node.tagName="span";node.setStyle("text-decoration","underline");break;case"s":case"strike":node.tagName="span";node.setStyle("text-decoration","line-through");}});});$.each(basestyles,function(i,cmd){me.commands[cmd]={execCommand:function(cmdName){return this.document.execCommand(cmdName);},queryCommandState:function(cmdName){return this.document.queryCommandState(cmdName);}};});};UE.plugins["video"]=function(){var me=this,div;function creatInsertStr(url,width,height,id,align,toEmbed){return !toEmbed?"<img "+(id?'id="'+id+'"':"")+' width="'+width+'" height="'+height+'" _url="'+url+'" class="edui-faked-video"'+' src="'+me.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+me.options.UEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(align?"float:"+align+";":"")+'" />':'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer"'+' src="'+url+'" width="'+width+'" height="'+height+'"'+(align?' style="float:'+align+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >';}function switchImgAndEmbed(root,img2embed){utils.each(root.getNodesByTagName(img2embed?"img":"embed"),function(node){if(node.getAttr("class")=="edui-faked-video"){var html=creatInsertStr(img2embed?node.getAttr("_url"):node.getAttr("src"),node.getAttr("width"),node.getAttr("height"),null,node.getStyle("float")||"",img2embed);node.parentNode.replaceChild(UE.uNode.createElement(html),node);}});}me.addOutputRule(function(root){switchImgAndEmbed(root,true);});me.addInputRule(function(root){switchImgAndEmbed(root);});me.commands["insertvideo"]={execCommand:function(cmd,videoObjs){videoObjs=utils.isArray(videoObjs)?videoObjs:[videoObjs];var html=[],id="tmpVedio";for(var i=0,vi,len=videoObjs.length;i<len;i++){vi=videoObjs[i];html.push(creatInsertStr(vi.url,vi.width||420,vi.height||280,id+i,null,false));}me.execCommand("inserthtml",html.join(""),true);},queryCommandState:function(){var img=me.selection.getRange().getClosedNode(),flag=img&&(img.className=="edui-faked-video");return flag?1:0;}};};UE.plugins["selectall"]=function(){var me=this;me.commands["selectall"]={execCommand:function(){var me=this,body=me.body,range=me.selection.getRange();range.selectNodeContents(body);if(domUtils.isEmptyBlock(body)){if(browser.opera&&body.firstChild&&body.firstChild.nodeType==1){range.setStartAtFirst(body.firstChild);}range.collapse(true);}range.select(true);},notNeedUndo:1};me.addshortcutkey({"selectAll":"ctrl+65"});};UE.plugins["removeformat"]=function(){var me=this;me.commands["removeformat"]={execCommand:function(){this.document.execCommand("removeformat");}};};UE.plugins["keystrokes"]=function(){var me=this;var collapsed=true;me.addListener("keydown",function(type,evt){var keyCode=evt.keyCode||evt.which,rng=me.selection.getRange();if(!rng.collapsed&&!(evt.ctrlKey||evt.shiftKey||evt.altKey||evt.metaKey)&&(keyCode>=65&&keyCode<=90||keyCode>=48&&keyCode<=57||keyCode>=96&&keyCode<=111||{13:1,8:1,46:1}[keyCode])){var tmpNode=rng.startContainer;if(domUtils.isFillChar(tmpNode)){rng.setStartBefore(tmpNode);}tmpNode=rng.endContainer;if(domUtils.isFillChar(tmpNode)){rng.setEndAfter(tmpNode);}rng.txtToElmBoundary();if(rng.endContainer&&rng.endContainer.nodeType==1){tmpNode=rng.endContainer.childNodes[rng.endOffset];if(tmpNode&&domUtils.isBr(tmpNode)){rng.setEndAfter(tmpNode);}}if(rng.startOffset==0){tmpNode=rng.startContainer;if(domUtils.isBoundaryNode(tmpNode,"firstChild")){tmpNode=rng.endContainer;if(rng.endOffset==(tmpNode.nodeType==3?tmpNode.nodeValue.length:tmpNode.childNodes.length)&&domUtils.isBoundaryNode(tmpNode,"lastChild")){me.fireEvent("saveScene");me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";rng.setStart(me.body.firstChild,0).setCursor(false,true);me._selectionChange();return;}}}}if(keyCode==8){rng=me.selection.getRange();collapsed=rng.collapsed;if(me.fireEvent("delkeydown",evt)){return;}var start,end;if(rng.collapsed&&rng.inFillChar()){start=rng.startContainer;if(domUtils.isFillChar(start)){rng.setStartBefore(start).shrinkBoundary(true).collapse(true);domUtils.remove(start);}else{start.nodeValue=start.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"");rng.startOffset--;rng.collapse(true).select(true);}}if(start=rng.getClosedNode()){me.fireEvent("saveScene");rng.setStartBefore(start);domUtils.remove(start);rng.setCursor();me.fireEvent("saveScene");domUtils.preventDefault(evt);return;}if(!browser.ie){start=domUtils.findParentByTagName(rng.startContainer,"table",true);end=domUtils.findParentByTagName(rng.endContainer,"table",true);if(start&&!end||!start&&end||start!==end){evt.preventDefault();return;}}}if(keyCode==9){var excludeTagNameForTabKey={"ol":1,"ul":1,"table":1};if(me.fireEvent("tabkeydown",evt)){domUtils.preventDefault(evt);return;}var range=me.selection.getRange();me.fireEvent("saveScene");for(var i=0,txt="",tabSize=me.options.tabSize||4,tabNode=me.options.tabNode||"&nbsp;";i<tabSize;i++){txt+=tabNode;}var span=me.document.createElement("span");span.innerHTML=txt+domUtils.fillChar;if(range.collapsed){range.insertNode(span.cloneNode(true).firstChild).setCursor(true);}else{start=domUtils.findParent(range.startContainer,filterFn);end=domUtils.findParent(range.endContainer,filterFn);if(start&&end&&start===end){range.deleteContents();range.insertNode(span.cloneNode(true).firstChild).setCursor(true);}else{var bookmark=range.createBookmark(),filterFn=function(node){return domUtils.isBlockElm(node)&&!excludeTagNameForTabKey[node.tagName.toLowerCase()];};range.enlarge(true);var bookmark2=range.createBookmark(),current=domUtils.getNextDomNode(bookmark2.start,false,filterFn);while(current&&!(domUtils.getPosition(current,bookmark2.end)&domUtils.POSITION_FOLLOWING)){current.insertBefore(span.cloneNode(true).firstChild,current.firstChild);current=domUtils.getNextDomNode(current,false,filterFn);}range.moveToBookmark(bookmark2).moveToBookmark(bookmark).select();}}domUtils.preventDefault(evt);}if(browser.gecko&&keyCode==46){range=me.selection.getRange();if(range.collapsed){start=range.startContainer;if(domUtils.isEmptyBlock(start)){var parent=start.parentNode;while(domUtils.getChildCount(parent)==1&&!domUtils.isBody(parent)){start=parent;parent=parent.parentNode;}if(start===parent.lastChild){evt.preventDefault();}return;}}}});me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which,rng,me=this;if(keyCode==8){if(me.fireEvent("delkeyup")){return;}rng=me.selection.getRange();if(rng.collapsed){var tmpNode,autoClearTagName=["h1","h2","h3","h4","h5","h6"];if(tmpNode=domUtils.findParentByTagName(rng.startContainer,autoClearTagName,true)){if(domUtils.isEmptyBlock(tmpNode)){var pre=tmpNode.previousSibling;if(pre&&pre.nodeName!="TABLE"){domUtils.remove(tmpNode);rng.setStartAtLast(pre).setCursor(false,true);return;}else{var next=tmpNode.nextSibling;if(next&&next.nodeName!="TABLE"){domUtils.remove(tmpNode);rng.setStartAtFirst(next).setCursor(false,true);return;}}}}if(domUtils.isBody(rng.startContainer)){var tmpNode=domUtils.createElement(me.document,"p",{"innerHTML":browser.ie?domUtils.fillChar:"<br/>"});rng.insertNode(tmpNode).setStart(tmpNode,0).setCursor(false,true);}}if(!collapsed&&(rng.startContainer.nodeType==3||rng.startContainer.nodeType==1&&domUtils.isEmptyBlock(rng.startContainer))){if(browser.ie){var span=rng.document.createElement("span");rng.insertNode(span).setStartBefore(span).collapse(true);rng.select();domUtils.remove(span);}else{rng.select();}}}});};(function($){$.parseTmpl=function parse(str,data){var tmpl="var __p=[],print=function(){__p.push.apply(__p,arguments);};"+"with(obj||{}){__p.push('"+str.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(match,code){return"',"+code.replace(/\\'/g,"'")+",'";}).replace(/<%([\s\S]+?)%>/g,function(match,code){return"');"+code.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('";}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');";var func=new Function("obj",tmpl);return data?func(data):func;};$.extend2=function(t,s){var a=arguments,notCover=$.type(a[a.length-1])=="boolean"?a[a.length-1]:false,len=$.type(a[a.length-1])=="boolean"?a.length-1:a.length;for(var i=1;i<len;i++){var x=a[i];for(var k in x){if(!notCover||!t.hasOwnProperty(k)){t[k]=x[k];}}}return t;};$.IE6=!!window.ActiveXObject&&parseFloat(navigator.userAgent.match(/msie (\d+)/i)[1])==6;var _eventHandler=[];var _widget=function(){};var _prefix="edui";_widget.prototype={on:function(ev,cb){this.root().on(ev,$.proxy(cb,this));return this;},off:function(ev,cb){this.root().off(ev,$.proxy(cb,this));return this;},trigger:function(ev,data){return this.root().trigger(ev,data)===false?false:this;},root:function($el){return this._$el||(this._$el=$el);},destroy:function(){},data:function(key,val){if(val!==undefined){this.root().data(_prefix+key,val);return this;}else{return this.root().data(_prefix+key);}},register:function(eventName,$el,fn){_eventHandler.push({"evtname":eventName,"$els":$.isArray($el)?$el:[$el],handler:$.proxy(fn,$el)});}};$.fn.edui=function(obj){return obj?this.data("eduiwidget",obj):this.data("eduiwidget");};function _createClass(ClassObj,properties,supperClass){ClassObj.prototype=$.extend2($.extend({},properties),(UE.ui[supperClass]||_widget).prototype,true);ClassObj.prototype.supper=(UE.ui[supperClass]||_widget).prototype;if(UE.ui[supperClass]&&UE.ui[supperClass].prototype.defaultOpt){var parentDefaultOptions=UE.ui[supperClass].prototype.defaultOpt,subDefaultOptions=ClassObj.prototype.defaultOpt;ClassObj.prototype.defaultOpt=$.extend({},parentDefaultOptions,subDefaultOptions||{});}return ClassObj;}var _guid=1;function mergeToJQ(ClassObj,className){$[_prefix+className]=ClassObj;$.fn[_prefix+className]=function(opt){var result,args=Array.prototype.slice.call(arguments,1);this.each(function(i,el){var $this=$(el);var obj=$this.edui();if(!obj){ClassObj(!opt||!$.isPlainObject(opt)?{}:opt,$this);$this.edui(obj);}if($.type(opt)=="string"){if(opt=="this"){result=obj;}else{result=obj[opt].apply(obj,args);if(result!==obj&&result!==undefined){return false;}result=null;}}});return result!==null?result:this;};}UE.ui={define:function(className,properties,supperClass){var ClassObj=UE.ui[className]=_createClass(function(options,$el){var _obj=function(){};$.extend(_obj.prototype,ClassObj.prototype,{guid:className+_guid++,widgetName:className});var obj=new _obj;if($.type(options)=="string"){obj.init&&obj.init({});obj.root().edui(obj);obj.root().find("a").click(function(evt){evt.preventDefault();});return obj.root()[_prefix+className].apply(obj.root(),arguments);}else{$el&&obj.root($el);obj.init&&obj.init(!options||$.isPlainObject(options)?$.extend2(options||{},obj.defaultOpt||{},true):options);try{obj.root().find("a").click(function(evt){evt.preventDefault();});}catch(e){}return obj.root().edui(obj);}},properties,supperClass);mergeToJQ(ClassObj,className);}};$(function(){$(document).on("click mouseup mousedown dblclickc mouseover",function(evt){$.each(_eventHandler,function(i,obj){if(obj.evtname==evt.type){$.each(obj.$els,function(i,$el){if($el[0]!==evt.target&&!$.contains($el[0],evt.target)){obj.handler(evt);}});}});});});})(jQuery);UE.ui.define("button",{tpl:'<<%if(!texttype){%>div class="edui-btn edui-btn-<%=icon%>" unselectable="on" onmousedown="return false" <%}else{%>a class="edui-text-btn"<%}%><% if(title) {%> data-original-title="<%=title%>" <%};%>> '+'<% if(icon) {%><div unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><% }; %><%if(text) {%><span unselectable="on" onmousedown="return false" class="edui-button-label"><%=text%></span><%}%>'+'<%if(caret && text){%><span class="edui-button-spacing"></span><%}%>'+'<% if(caret) {%><span unselectable="on" onmousedown="return false" class="edui-caret"></span><% };%></<%if(!texttype){%>div<%}else{%>a<%}%>>',defaultOpt:{text:"",title:"",icon:"",width:"",caret:false,texttype:false,click:function(){}},init:function(options){var me=this;me.root($($.parseTmpl(me.tpl,options))).click(function(evt){me.wrapclick(options.click,evt);});me.root().hover(function(){if(!me.root().hasClass("disabled")){me.root().toggleClass("hover");}});return me;},wrapclick:function(fn,evt){if(!this.disabled()){this.root().trigger("wrapclick");$.proxy(fn,this,evt)();}return this;},label:function(text){if(text===undefined){return this.root().find(".edui-button-label").text();}else{this.root().find(".edui-button-label").text(text);return this;}},disabled:function(state){if(state===undefined){return this.root().hasClass("disabled");}this.root().toggleClass("disabled",state);return this;},active:function(state){if(state===undefined){return this.root().hasClass("active");}this.root().toggleClass("active",state);return this;},mergeWith:function($obj){var me=this;me.data("$mergeObj",$obj);$obj.edui().data("$mergeObj",me.root());if(!$.contains(document.body,$obj[0])){$obj.appendTo(me.root());}me.on("click",function(){me.wrapclick(function(){$obj.edui().show();});}).register("click",me.root(),function(evt){$obj.hide();});}});(function(){UE.ui.define("toolbar",{tpl:'<div class="edui-toolbar"  ><div class="edui-btn-toolbar" unselectable="on" onmousedown="return false"  ></div></div>',init:function(){var $root=this.root($(this.tpl));this.data("$btnToolbar",$root.find(".edui-btn-toolbar"));},appendToBtnmenu:function(data){var $cont=this.data("$btnToolbar");data=$.isArray(data)?data:[data];$.each(data,function(i,$item){$cont.append($item);});}});})();UE.ui.define("menu",{show:function($obj,dir,fnname,topOffset,leftOffset){fnname=fnname||"position";if(this.trigger("beforeshow")===false){return;}else{this.root().css($.extend({display:"block"},$obj?{top:$obj[fnname]().top+(dir=="right"?0:$obj.outerHeight())-(topOffset||0),left:$obj[fnname]().left+(dir=="right"?$obj.outerWidth():0)-(leftOffset||0)}:{}));this.trigger("aftershow");}},hide:function(all){var $parentmenu;if(this.trigger("beforehide")===false){return;}else{if($parentmenu=this.root().data("parentmenu")){if($parentmenu.data("parentmenu")||all){$parentmenu.edui().hide();}}this.root().css("display","none");this.trigger("afterhide");}},attachTo:function($obj){var me=this;if(!$obj.data("$mergeObj")){$obj.data("$mergeObj",me.root());$obj.on("wrapclick",function(evt){me.show();});me.register("click",$obj,function(evt){me.hide();});me.data("$mergeObj",$obj);}}});UE.ui.define("dropmenu",{tmpl:'<ul class="edui-dropdown-menu" aria-labelledby="dropdownMenu" >'+"<%for(var i=0,ci;ci=data[i++];){%>"+'<%if(ci.divider){%><li class="edui-divider"></li><%}else{%>'+"<li <%if(ci.active||ci.disabled){%>class=\"<%= ci.active|| '' %> <%=ci.disabled||'' %>\" <%}%> data-value=\"<%= ci.value%>\">"+'<a href="#" tabindex="-1"><em class="edui-dropmenu-checkbox"><i class="edui-icon-ok"></i></em><%= ci.label%></a>'+"</li><%}%>"+"<%}%>"+"</ul>",defaultOpt:{data:[],click:function(){}},init:function(options){var me=this;var eventName={click:1,mouseover:1,mouseout:1};this.root($($.parseTmpl(this.tmpl,options))).on("click",'li[class!="disabled divider dropdown-submenu"]',function(evt){$.proxy(options.click,me,evt,$(this).data("value"),$(this))();}).find("li").each(function(i,el){var $this=$(this);if(!$this.hasClass("disabled divider dropdown-submenu")){var data=options.data[i];$.each(eventName,function(k){data[k]&&$this[k](function(evt){$.proxy(data[k],el)(evt,data,me.root);});});}});},disabled:function(cb){$("li[class!=divider]",this.root()).each(function(){var $el=$(this);if(cb===true){$el.addClass("disabled");}else{if($.isFunction(cb)){$el.toggleClass("disabled",cb(li));}else{$el.removeClass("disabled");}}});},val:function(val){var currentVal;$('li[class!="divider disabled dropdown-submenu"]',this.root()).each(function(){var $el=$(this);if(val===undefined){if($el.find("em.edui-dropmenu-checked").length){currentVal=$el.data("value");return false;}}else{$el.find("em").toggleClass("edui-dropmenu-checked",$el.data("value")==val);}});if(val===undefined){return currentVal;}},addSubmenu:function(label,menu,index){index=index||0;$("li[class!=divider]",this.root()).each(function(i,l){if(index==i){$('<li class="dropdown-submenu"><a tabindex="-1" href="#">'+label+"</a></li>").append(menu).insertBefore($(l));return false;}});}},"menu");UE.ui.define("splitbutton",{tpl:'<div class="edui-splitbutton"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><%if(text){%><%=text%><%}%></div>'+'<div  unselectable="on" class="edui-btn edui-dropdown-toggle" >'+'<div  unselectable="on" class="edui-caret"></div>'+"</div>"+"</div>",defaultOpt:{text:"",title:"",click:function(){}},init:function(options){var me=this;me.root($($.parseTmpl(me.tpl,options)));me.root().find(".edui-btn:first").click(function(evt){if(!me.disabled()){$.proxy(options.click,me)();}});me.root().find(".edui-dropdown-toggle").click(function(){if(!me.disabled()){me.trigger("arrowclick");}});me.root().hover(function(){if(!me.root().hasClass("disabled")){me.root().toggleClass("hover");}});return me;},wrapclick:function(fn,evt){if(!this.disabled()){$.proxy(fn,this,evt)();}return this;},disabled:function(state){if(state===undefined){return this.root().hasClass("disabled");}this.root().toggleClass("disabled",state).find(".edui-btn").toggleClass("disabled",state);return this;},active:function(state){if(state===undefined){return this.root().hasClass("active");}this.root().toggleClass("active",state).find(".edui-btn:first").toggleClass("active",state);return this;},mergeWith:function($obj){var me=this;me.data("$mergeObj",$obj);$obj.edui().data("$mergeObj",me.root());if(!$.contains(document.body,$obj[0])){$obj.appendTo(me.root());}me.root().on("click",".edui-dropdown-toggle",function(){me.wrapclick(function(){$obj.edui().show();});});me.register("click",me.root().find(".edui-dropdown-toggle"),function(evt){$obj.hide();});}});UE.ui.define("colorsplitbutton",{tpl:'<div class="edui-splitbutton"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><div class="edui-splitbutton-color-label" <%if (color) {%>style="background: <%=color%>"<%}%>></div><%if(text){%><%=text%><%}%></div>'+'<div  unselectable="on" class="edui-btn edui-dropdown-toggle" >'+'<div  unselectable="on" class="edui-caret"></div>'+"</div>"+"</div>",defaultOpt:{color:""},init:function(options){var me=this;me.supper.init.call(me,options);},colorLabel:function(){return this.root().find(".edui-splitbutton-color-label");}},"splitbutton");UE.ui.define("popup",{tpl:'<div class="edui-dropdown-menu edui-popup" onmousedown="return false">'+'<div class="edui-popup-body"><%=subtpl%></div>'+'<div class="edui-popup-caret"></div>'+"</div>",defaultOpt:{subtpl:"",width:"",height:""},init:function(options){this.root($($.parseTmpl(this.tpl,options)));return this;},mergeTpl:function(data){return $.parseTmpl(this.tpl,{subtpl:data});},show:function($obj,posObj){if(!posObj){posObj={};}var fnname=posObj.fnname||"position";if(this.trigger("beforeshow")===false){return;}else{this.root().css($.extend({display:"block"},$obj?{top:$obj[fnname]().top+(posObj.dir=="right"?0:$obj.outerHeight())-(posObj.offsetTop||0),left:$obj[fnname]().left+(posObj.dir=="right"?$obj.outerWidth():0)-(posObj.offsetLeft||0),position:"absolute"}:{}));this.root().find(".edui-popup-caret").css({top:posObj.caretTop||0,left:posObj.caretLeft||0,position:"absolute"}).addClass(posObj.caretDir||"up");}this.trigger("aftershow");},hide:function(){this.root().css("display","none");this.trigger("afterhide");},attachTo:function($obj,posObj){var me=this;if(!$obj.data("$mergeObj")){$obj.data("$mergeObj",me.root());$obj.on("wrapclick",function(evt){me.show($obj,posObj);});me.register("click",$obj,function(evt){me.hide();});me.data("$mergeObj",$obj);}},getBodyContainer:function(){return this.root().find(".edui-popup-body");}});UE.ui.define("scale",{tpl:'<div class="edui-scale" unselectable="on">'+'<span class="edui-scale-hand0"></span>'+'<span class="edui-scale-hand1"></span>'+'<span class="edui-scale-hand2"></span>'+'<span class="edui-scale-hand3"></span>'+'<span class="edui-scale-hand4"></span>'+'<span class="edui-scale-hand5"></span>'+'<span class="edui-scale-hand6"></span>'+'<span class="edui-scale-hand7"></span>'+"</div>",defaultOpt:{doc:document},init:function(options){this.root($($.parseTmpl(this.tpl,options)));this.initStyle();this.startPos=this.prePos={x:0,y:0};this.dragId=-1;return this;},initStyle:function(){utils.cssRule("scale",".edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}"+".edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}"+".edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}"+".edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}"+".edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}"+".edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}"+".edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}"+".edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}"+".edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}"+".edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}");},_eventHandler:function(e){var me=this,doc=me.defaultOpt.doc;switch(e.type){case"mousedown":var hand=e.target||e.srcElement,hand;if(hand.className.indexOf("edui-scale-hand")!=-1){me.dragId=hand.className.slice(-1);me.startPos.x=me.prePos.x=e.clientX;me.startPos.y=me.prePos.y=e.clientY;$(doc).bind("mousemove",$.proxy(me._eventHandler,me));}break;case"mousemove":if(me.dragId!=-1){me.updateContainerStyle(me.dragId,{x:e.clientX-me.prePos.x,y:e.clientY-me.prePos.y});me.prePos.x=e.clientX;me.prePos.y=e.clientY;me.updateTargetElement();}break;case"mouseup":if(me.dragId!=-1){me.dragId=-1;me.updateTargetElement();var target=me.data("$scaleTarget");if(target.parentNode){me.attachTo(me.data("$scaleTarget"));}}$(doc).unbind("mousemove",$.proxy(me._eventHandler,me));break;default:break;}},updateTargetElement:function(){var $root=this.root();this.data("$scaleTarget").css({width:$root.width(),height:$root.height()});},updateContainerStyle:function(dir,offset){var me=this,$dom=me.root(),tmp,rect=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];if(rect[dir][0]!=0){tmp=parseInt($dom.offset().left)+offset.x;$dom.css("left",me._validScaledProp("left",tmp));}if(rect[dir][1]!=0){tmp=parseInt($dom.offset().top)+offset.y;$dom.css("top",me._validScaledProp("top",tmp));}if(rect[dir][2]!=0){tmp=$dom.width()+rect[dir][2]*offset.x;$dom.css("width",me._validScaledProp("width",tmp));}if(rect[dir][3]!=0){tmp=$dom.height()+rect[dir][3]*offset.y;$dom.css("height",me._validScaledProp("height",tmp));}},_validScaledProp:function(prop,value){var $ele=this.root(),$wrap=$(this.defaultOpt.doc),calc=function(val,a,b){return(val+a)>b?b-a:value;};value=isNaN(value)?0:value;switch(prop){case"left":return value<0?0:calc(value,$ele.width(),$wrap.width());case"top":return value<0?0:calc(value,$ele.height(),$wrap.height());case"width":return value<=0?1:calc(value,$ele.offset().left,$wrap.width());case"height":return value<=0?1:calc(value,$ele.offset().top,$wrap.height());}},show:function($obj){var me=this;if($obj){me.attachTo($obj);}me.root().bind("mousedown",$.proxy(me._eventHandler,me));$(me.defaultOpt.doc).bind("mouseup",$.proxy(me._eventHandler,me));me.root().show();me.trigger("aftershow");},hide:function(){var me=this;me.root().unbind("mousedown",$.proxy(me._eventHandler,me));$(me.defaultOpt.doc).unbind("mouseup",$.proxy(me._eventHandler,me));me.root().hide();me.trigger("afterhide");},attachTo:function($obj){var me=this,imgPos=$obj.offset(),posObj=$(me.defaultOpt.doc.body).offset();me.data("$scaleTarget",$obj);me.root().css({position:"absolute",width:$obj.width(),height:$obj.height(),left:imgPos.left-posObj.left-2,top:imgPos.top-posObj.top-2});},getScaleTarget:function(){return this.data("$scaleTarget")[0];}});UE.ui.define("colorpicker",{tpl:function(opt){var COLORS=("ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,"+"f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,"+"d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,"+"bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,"+"a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,"+"7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,"+"c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,").split(",");var html='<div class="edui-colorpicker" >'+"<table>"+'<tr><td colspan="10">'+opt.lang_themeColor+"</td> </tr>"+'<tr class="edui-colorpicker-firstrow" >';for(var i=0;i<COLORS.length;i++){if(i&&i%10===0){html+="</tr>"+(i==60?'<tr><td colspan="10">'+opt.lang_standardColor+"</td></tr>":"")+"<tr"+(i==60?' class="edui-colorpicker-firstrow"':"")+">";}html+=i<70?'<td><a unselectable="on" onmousedown="return false" title="'+COLORS[i]+'" class="edui-colorpicker-colorcell"'+' data-color="#'+COLORS[i]+'"'+' style="background-color:#'+COLORS[i]+";border:solid #ccc;"+(i<10||i>=60?"border-width:1px;":i>=10&&i<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"'+"></a></td>":"";}html+="</tr></table></div>";return html;},init:function(options){var me=this;me.root($($.parseTmpl(me.supper.mergeTpl(me.tpl(options)),options)));me.root().find("table").on("mouseover",function(e){var color=e.target.getAttribute("data-color");if(color){me.root().find(".edui-colorpicker-preview").css("background-color",color);}}).on("mouseout",function(){me.root().find(".edui-colorpicker-preview").css("background-color","");});me.root().on("click",function(e){me.trigger("pickcolor",$(e.target).data("color"));});}},"popup");(function(){var widgetName="tablepicker";UE.ui.define(widgetName,{tpl:function(options){var tmpl=[],currRow=null,colCount=options.maxColNum,rowCount=options.maxRowNum;while(rowCount--){currRow=[];for(var i=0;i<=colCount;i++){currRow.push("");}tmpl.push("<tr>"+currRow.join("<td></td>")+"</tr>");}return'<div class="edui-tablepicker-createbox"><div class="edui-tablepicker-panel"><div class="edui-tablepicker-controller" style="width: <%=maxColNum*cellWidth+borderWidth%>px; height: <%=maxRowNum*cellWidth+borderWidth%>px;"><div class="edui-tablepicker-selected-box"></div><table><tbody>'+tmpl.join("")+'</tbody></table></div></div><div class="edui-tablepicker-label"></div>';},defaultOpt:{maxRowNum:20,maxColNum:20,rowCount:10,colCount:10,target:null,mode:"menu"},init:function(options){var me=this;options.cellWidth=18;options.borderWidth=0;me.root($($.parseTmpl(me.supper.mergeTpl(me.tpl(options)),options)));me.data("table",me.root().find("table:first")[0]);me.data("$container",me.root().find(".edui-tablepicker-panel:first"));me.data("$selectedBox",me.root().find(".edui-tablepicker-selected-box:first"));me.data("label",me.root().find(".edui-tablepicker-label:first")[0]);me.data("curRowCount",options.rowCount).data("curColCount",options.colCount).data("curHoverRow",options.rowCount).data("curHoverCol",options.colCount);me.data("options",options);this.initEvent();},initEvent:function(){var _self=this;this.root().delegate("td","mousemove",function(){var rowIndex=this.parentNode.rowIndex+1,colIndex=this.cellIndex+1;_self._expansion(rowIndex,colIndex);});this.root().delegate("td","click",function(evt){var rowIndex=this.parentNode.rowIndex+1,colIndex=this.cellIndex+1;_self.hide();_self.trigger("select",[rowIndex,colIndex]);});this.root().delegate("td","mouseover",function(evt){evt.stopPropagation();evt.preventDefault();});this.on("afterhide",function(){this.reset();});},_expansion:function(rowIndex,colIndex){var toWidth=0,toHeight=0,options=this.data("options");if(rowIndex!==this.data("curHoverRow")||colIndex!==this.data("curHoverCol")){this.updateCount(rowIndex,colIndex);this.data("$selectedBox").css({width:colIndex*options.cellWidth+"px",height:rowIndex*options.cellWidth+"px"});if(rowIndex==this.data("curRowCount")&&rowIndex<options.maxRowNum){this.data("curRowCount",++rowIndex);toHeight=rowIndex*options.cellWidth;}else{if(rowIndex<this.data("curRowCount")-1&&rowIndex>options.rowCount-2){this.data("curRowCount",++rowIndex);toHeight=rowIndex*options.cellWidth;}}if(colIndex==this.data("curColCount")&&colIndex<options.maxColNum){this.data("curColCount",++colIndex);toWidth=colIndex*options.cellWidth;}else{if(colIndex<this.data("curColCount")-1&&colIndex>options.colCount-2){this.data("curColCount",++colIndex);toWidth=colIndex*options.cellWidth;}}var styles={};toWidth&&(styles["width"]=toWidth+"px");toHeight&&(styles["height"]=toHeight+"px");this.data("$container").css(styles);}},updateCount:function(rowCount,colCount){this.data("curHoverRow",rowCount).data("curHoverCol",colCount);this.data("label").innerHTML=rowCount+" X "+colCount;},reset:function(){var options=this.data("options"),$container=this.data("$container"),$selectedBox=this.data("$selectedBox");$container.css({width:options.rowCount*options.cellWidth+"px",height:options.colCount*options.cellWidth+"px"});$selectedBox.css({width:0,heihgt:0});this.data("label").innerHTML="";}},"popup");})();(function(){var widgetName="combobox",itemClassName="edui-combobox-item",HOVER_CLASS="edui-combobox-item-hover",ICON_CLASS="edui-combobox-checked-icon",labelClassName="edui-combobox-item-label";UE.ui.define(widgetName,(function(){return{tpl:'<ul class="dropdown-menu edui-combobox-menu<%if (comboboxName!==\'\') {%> edui-combobox-<%=comboboxName%><%}%>" role="menu" aria-labelledby="dropdownMenu">'+"<%if(autoRecord) {%>"+"<%for( var i=0, len = recordStack.length; i<len; i++ ) {%>"+"<%var index = recordStack[i];%>"+'<li class="<%=itemClassName%><%if( selected == index ) {%> edui-combobox-checked<%}%>" data-item-index="<%=index%>" unselectable="on" onmousedown="return false">'+'<span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span>'+'<label class="<%=labelClassName%>" style="<%=itemStyles[ index ]%>" unselectable="on" onmousedown="return false"><%=items[index]%></label>'+"</li>"+"<%}%>"+"<%if( i ) {%>"+'<li class="edui-combobox-item-separator"></li>'+"<%}%>"+"<%}%>"+"<%for( var i=0, label; label = items[i]; i++ ) {%>"+'<li class="<%=itemClassName%><%if( selected == i ) {%> edui-combobox-checked<%}%> edui-combobox-item-<%=i%>" data-item-index="<%=i%>" unselectable="on" onmousedown="return false">'+'<span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span>'+'<label class="<%=labelClassName%>" style="<%=itemStyles[ i ]%>" unselectable="on" onmousedown="return false"><%=label%></label>'+"</li>"+"<%}%>"+"</ul>",defaultOpt:{recordStack:[],items:[],value:[],comboboxName:"",selected:"",autoRecord:true,recordCount:5},init:function(options){var me=this;$.extend(me._optionAdaptation(options),me._createItemMapping(options.recordStack,options.items),{itemClassName:itemClassName,iconClass:ICON_CLASS,labelClassName:labelClassName});this._transStack(options);me.root($($.parseTmpl(me.tpl,options)));this.data("options",options).initEvent();},initEvent:function(){var me=this;me.initSelectItem();this.initItemActive();},initSelectItem:function(){var me=this,labelClass="."+labelClassName;me.root().delegate("."+itemClassName,"click",function(){var $li=$(this),index=$li.attr("data-item-index");me.trigger("comboboxselect",{index:index,label:$li.find(labelClass).text(),value:me.data("options").value[index]}).select(index);me.hide();return false;});},initItemActive:function(){var fn={mouseenter:"addClass",mouseleave:"removeClass"};if($.IE6){this.root().delegate("."+itemClassName,"mouseenter mouseleave",function(evt){$(this)[fn[evt.type]](HOVER_CLASS);}).one("afterhide",function(){});}},select:function(index){var itemCount=this.data("options").itemCount,items=this.data("options").autowidthitem;if(itemCount==0){return null;}if(index<0){index=itemCount+index%itemCount;}else{if(index>=itemCount){index=itemCount-1;}}this.trigger("changebefore",items[index]);this._update(index);this.trigger("changeafter",items[index]);return null;},selectItemByLabel:function(label){var itemMapping=this.data("options").itemMapping,me=this,index=null;!$.isArray(label)&&(label=[label]);$.each(label,function(i,item){index=itemMapping[item];if(index!==undefined){me.select(index);return false;}});},_transStack:function(options){var temp=[],itemIndex=-1,selected=-1;$.each(options.recordStack,function(index,item){itemIndex=options.itemMapping[item];if($.isNumeric(itemIndex)){temp.push(itemIndex);if(item==options.selected){selected=itemIndex;}}});options.recordStack=temp;options.selected=selected;temp=null;},_optionAdaptation:function(options){if(!("itemStyles" in options)){options.itemStyles=[];for(var i=0,len=options.items.length;i<len;i++){options.itemStyles.push("");}}options.autowidthitem=options.autowidthitem||options.items;options.itemCount=options.items.length;return options;},_createItemMapping:function(stackItem,items){var temp={},result={recordStack:[],mapping:{}};$.each(items,function(index,item){temp[item]=index;});result.itemMapping=temp;$.each(stackItem,function(index,item){if(temp[item]!==undefined){result.recordStack.push(temp[item]);result.mapping[item]=temp[item];}});return result;},_update:function(index){var options=this.data("options"),newStack=[],newChilds=null;$.each(options.recordStack,function(i,item){if(item!=index){newStack.push(item);}});newStack.unshift(index);if(newStack.length>options.recordCount){newStack.length=options.recordCount;}options.recordStack=newStack;options.selected=index;newChilds=$($.parseTmpl(this.tpl,options));this.root().html(newChilds.html());newChilds=null;newStack=null;}};})(),"menu");})();(function(){var widgetName="buttoncombobox";UE.ui.define(widgetName,(function(){return{defaultOpt:{label:"",title:""},init:function(options){var me=this;var btnWidget=$.eduibutton({caret:true,title:options.title,mode:options.mode,text:options.label,click:function(){me.show(this.root());}});me.supper.init.call(me,options);me.on("changebefore",function(e,label){btnWidget.eduibutton("label",label);});me.data("button",btnWidget);me.attachTo(btnWidget);},button:function(){return this.data("button");}};})(),"combobox");})();UE.ui.define("modal",{tpl:'<div class="edui-modal" tabindex="-1" >'+'<div class="edui-modal-header">'+'<div class="edui-close" data-hide="modal"></div>'+'<h3 class="edui-title"><%=title%></h3>'+"</div>"+'<div class="edui-modal-body"  style="<%if(width){%>width:<%=width%>px;<%}%>'+'<%if(height){%>height:<%=height%>px;<%}%>">'+" </div>"+"<% if(cancellabel || oklabel) {%>"+'<div class="edui-modal-footer">'+'<%if(oklabel){%><div class="edui-btn edui-btn-primary" data-ok="modal"><%=oklabel%></div><%}%>'+'<%if(cancellabel){%><div class="edui-btn" data-hide="modal"><%=cancellabel%></div><%}%>'+"</div>"+"<%}%></div>",defaultOpt:{title:"",cancellabel:"",oklabel:"",width:"",height:"",backdrop:true,keyboard:true,show:false},init:function(options){var me=this;me.root($($.parseTmpl(me.tpl,options||{})));me.data("options",options);if(options.okFn){me.on("ok",$.proxy(options.okFn,me));}if(options.cancelFn){me.on("beforehide",$.proxy(options.cancelFn,me));}me.root().delegate('[data-hide="modal"]',"click",$.proxy(me.hide,me)).delegate('[data-ok="modal"]',"click",$.proxy(me.ok,me));$('[data-hide="modal"],[data-ok="modal"]',me.root()).hover(function(){$(this).toggleClass("hover");});},toggle:function(){var me=this;return me[!me.data("isShown")?"show":"hide"]();},show:function(){var me=this;me.trigger("beforeshow");if(me.data("isShown")){return;}me.data("isShown",true);me.escape();me.backdrop(function(){me.autoCenter();me.root().show().focus().trigger("aftershow");});},autoCenter:function(){!$.IE6&&this.root().css("margin-left",-(this.root().width()/2));},hide:function(){var me=this;me.trigger("beforehide");if(!me.data("isShown")){return;}me.data("isShown",false);me.escape();me.hideModal();},escape:function(){var me=this;if(me.data("isShown")&&me.data("options").keyboard){me.root().on("keyup",function(e){e.which==27&&me.hide();});}else{if(!me.data("isShown")){me.root().off("keyup");}}},hideModal:function(){var me=this;me.root().hide();me.backdrop(function(){me.removeBackdrop();me.trigger("afterhide");});},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null;},backdrop:function(callback){var me=this;if(me.data("isShown")&&me.data("options").backdrop){me.$backdrop=$('<div class="edui-modal-backdrop" />').click(me.data("options").backdrop=="static"?$.proxy(me.root()[0].focus,me.root()[0]):$.proxy(me.hide,me));}me.trigger("afterbackdrop");callback&&callback();},attachTo:function($obj){var me=this;if(!$obj.data("$mergeObj")){$obj.data("$mergeObj",me.root());$obj.on("click",function(){me.toggle($obj);});me.data("$mergeObj",$obj);}},ok:function(){var me=this;me.trigger("beforeok");if(me.trigger("ok",me)===false){return;}me.hide();},getBodyContainer:function(){return this.root().find(".edui-modal-body");}});UE.ui.define("tooltip",{tpl:'<div class="edui-tooltip" unselectable="on" onmousedown="return false"><div class="edui-tooltip-arrow" unselectable="on" onmousedown="return false"></div><div class="edui-tooltip-inner" unselectable="on" onmousedown="return false"></div></div>',init:function(options){var me=this;me.root($($.parseTmpl(me.tpl,options||{})));},content:function(e){var me=this,title=$(e.currentTarget).attr("data-original-title");me.root().find(".edui-tooltip-inner")["text"](title);},position:function(e){var me=this,$obj=$(e.currentTarget);me.root().css($.extend({display:"block"},$obj?{top:$obj.outerHeight(),left:(($obj.outerWidth()-me.root().outerWidth())/2)}:{}));},show:function(e){var me=this;me.content(e);me.root().appendTo($(e.currentTarget));me.position(e);me.root().css("display","block").addClass("in bottom");},hide:function(){var me=this;me.root().removeClass("in bottom").css("display","none");},attachTo:function($obj){var me=this;function tmp($obj){var me=this;if(!$.contains(document.body,me.root()[0])){me.root().appendTo($obj);}me.data("tooltip",me.root());$obj.each(function(){if($(this).attr("data-original-title")){$(this).on("mouseenter",$.proxy(me.show,me)).on("mouseleave click",$.proxy(me.hide,me));}});}if($.type($obj)==="undefined"){$("[data-original-title]").each(function(i,el){tmp.call(me,$(el));});}else{if(!$obj.data("tooltip")){tmp.call(me,$obj);}}}});UE.ui.define("tab",{init:function(options){var me=this,slr=options.selector;if($.type(slr)){me.root($(slr,options.context));me.data("context",options.context);$(slr,me.data("context")).on("click",function(e){me.show(e);});}},show:function(e){var me=this,$cur=$(e.target),$ul=$cur.closest("ul"),selector,previous,$target,e;selector=$cur.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"");var $tmp=$cur.parent("li");if(!$tmp.length||$tmp.hasClass("active")){return;}previous=$ul.find(".active:last a")[0];e=$.Event("beforeshow",{target:$cur[0],relatedTarget:previous});me.trigger(e);if(e.isDefaultPrevented()){return;}$target=$(selector,me.data("context"));me.activate($cur.parent("li"),$ul);me.activate($target,$target.parent(),function(){me.trigger({type:"aftershow",relatedTarget:previous});});},activate:function(element,container,callback){if(element===undefined){return $(".edui-tab-item.active",this.root()).index();}var $active=container.find("> .active");$active.removeClass("active");element.addClass("active");callback&&callback();}});UE.ui.define("separator",{tpl:'<div class="edui-separator" unselectable="on" onmousedown="return false" ></div>',init:function(options){var me=this;me.root($($.parseTmpl(me.tpl,options)));return me;}});UE.ui.define("scale",{tpl:'<div class="edui-scale" unselectable="on">'+'<span class="edui-scale-hand0"></span>'+'<span class="edui-scale-hand1"></span>'+'<span class="edui-scale-hand2"></span>'+'<span class="edui-scale-hand3"></span>'+'<span class="edui-scale-hand4"></span>'+'<span class="edui-scale-hand5"></span>'+'<span class="edui-scale-hand6"></span>'+'<span class="edui-scale-hand7"></span>'+"</div>",defaultOpt:{doc:document},init:function(options){this.root($($.parseTmpl(this.tpl,options)));this.initStyle();this.startPos=this.prePos={x:0,y:0};this.dragId=-1;return this;},initStyle:function(){utils.cssRule("scale",".edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}"+".edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}"+".edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}"+".edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}"+".edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}"+".edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}"+".edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}"+".edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}"+".edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}"+".edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}");},_eventHandler:function(e){var me=this,doc=me.defaultOpt.doc;switch(e.type){case"mousedown":var hand=e.target||e.srcElement,hand;if(hand.className.indexOf("edui-scale-hand")!=-1){me.dragId=hand.className.slice(-1);me.startPos.x=me.prePos.x=e.clientX;me.startPos.y=me.prePos.y=e.clientY;$(doc).bind("mousemove",$.proxy(me._eventHandler,me));}break;case"mousemove":if(me.dragId!=-1){me.updateContainerStyle(me.dragId,{x:e.clientX-me.prePos.x,y:e.clientY-me.prePos.y});me.prePos.x=e.clientX;me.prePos.y=e.clientY;me.updateTargetElement();}break;case"mouseup":if(me.dragId!=-1){me.dragId=-1;me.updateTargetElement();var target=me.data("$scaleTarget");if(target.parentNode){me.attachTo(me.data("$scaleTarget"));}}$(doc).unbind("mousemove",$.proxy(me._eventHandler,me));break;default:break;}},updateTargetElement:function(){var $root=this.root();this.data("$scaleTarget").css({width:$root.width(),height:$root.height()});},updateContainerStyle:function(dir,offset){var me=this,$dom=me.root(),tmp,rect=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];if(rect[dir][0]!=0){tmp=parseInt($dom.offset().left)+offset.x;$dom.css("left",me._validScaledProp("left",tmp));}if(rect[dir][1]!=0){tmp=parseInt($dom.offset().top)+offset.y;$dom.css("top",me._validScaledProp("top",tmp));}if(rect[dir][2]!=0){tmp=$dom.width()+rect[dir][2]*offset.x;$dom.css("width",me._validScaledProp("width",tmp));}if(rect[dir][3]!=0){tmp=$dom.height()+rect[dir][3]*offset.y;$dom.css("height",me._validScaledProp("height",tmp));}},_validScaledProp:function(prop,value){var $ele=this.root(),$wrap=$(this.defaultOpt.doc),calc=function(val,a,b){return(val+a)>b?b-a:value;};value=isNaN(value)?0:value;switch(prop){case"left":return value<0?0:calc(value,$ele.width(),$wrap.width());case"top":return value<0?0:calc(value,$ele.height(),$wrap.height());case"width":return value<=0?1:calc(value,$ele.offset().left,$wrap.width());case"height":return value<=0?1:calc(value,$ele.offset().top,$wrap.height());}},show:function($obj){var me=this;if($obj){me.attachTo($obj);}me.root().bind("mousedown",$.proxy(me._eventHandler,me));$(me.defaultOpt.doc).bind("mouseup",$.proxy(me._eventHandler,me));me.root().show();me.trigger("aftershow");},hide:function(){var me=this;me.root().unbind("mousedown",$.proxy(me._eventHandler,me));$(me.defaultOpt.doc).unbind("mouseup",$.proxy(me._eventHandler,me));me.root().hide();me.trigger("afterhide");},attachTo:function($obj){var me=this,imgPos=$obj.offset(),posObj=$(me.defaultOpt.doc.body).offset();me.data("$scaleTarget",$obj);me.root().css({position:"absolute",width:$obj.width(),height:$obj.height(),left:imgPos.left-posObj.left-2,top:imgPos.top-posObj.top-2});},getScaleTarget:function(){return this.data("$scaleTarget")[0];}});(function(){var _editorUI={},_editors={},_readyFn=[],_activeEditor=null,_activeWidget=null,_widgetData={},_widgetCallBack={};utils.extend(UE,{registerUI:function(name,fn){utils.each(name.split(/\s+/),function(uiname){_editorUI[uiname]=fn;});},getWidgetCallback:function(widgetName){return _widgetCallBack[widgetName];},registerWidget:function(name,pro,cb){_widgetData[name]=$.extend2(pro,{$root:null,_preventDefault:false,root:function($el){return this.$root||(this.$root=$el);},preventDefault:function(){this._preventDefault=true;},clear:false});if(cb){_widgetCallBack[name]=cb;}},getWidgetData:function(name){return _widgetData[name];},setWidgetBody:function(name,$widget,editor){var pro=_widgetData[name];if(!pro){return null;}pro.root($widget.edui().getBodyContainer());pro.initContent(editor,$widget);if(!pro._preventDefault){pro.initEvent(editor,$widget);}pro.width&&$widget.width(pro.width);var cb=_widgetCallBack[name];if(cb&&!cb.init){_widgetCallBack[name]=function(){var args=Array.prototype.slice.call(arguments,0);cb.apply(editor,[editor,$widget].concat(args));};_widgetCallBack[name].init=true;}},getUI:function(editor,name,mode){if(_editorUI[name]){return $.proxy(_editorUI[name],editor,name,mode)();}return null;},setActiveEditor:function(editor){_activeEditor=editor;},getActiveEditor:function($widget){var ac;utils.each(UE.instants,function(editor){if(editor.selection.isFocus()){ac=editor;return false;}});if(ac){return ac;}var $container=$widget.parents(".edui-container");if(_activeEditor){if($container[0]===_activeEditor.container){return _activeEditor;}}$.each(_editors,function(id,val){if(val.container===$container[0]){ac=val;return false;}});return ac;},setActiveWidget:function($widget){_activeWidget=$widget;},getActiveWidget:function(){return _activeWidget;},getEditor:function(id,options){return _editors[id]||(_editors[id]=this.createEditor(id,options));},ready:function(fn){_readyFn.push(fn);},createEditor:function(id,opt){var editor=new UE.Editor(opt);var T=this;editor.langIsReady?$.proxy(renderUI,T)():editor.addListener("langReady",$.proxy(renderUI,T));function renderUI(){var $container=this.createUI("#"+id,editor);editor.ready(function(){$.each(_readyFn,function(index,fn){$.proxy(fn,editor)();});});var options=editor.options;if(options.initialFrameWidth){options.minFrameWidth=options.initialFrameWidth;}else{options.minFrameWidth=options.initialFrameWidth=editor.$body.width();}$container.css({width:options.initialFrameWidth,zIndex:editor.getOpt("zIndex")});editor.render(id);$.eduitooltip&&$.eduitooltip("attachTo").css("z-index",editor.getOpt("zIndex")+1);$container.find("a").click(function(evt){evt.preventDefault();});}return editor;},createUI:function(id,editor){var $editorCont=$(id),$container=$('<div class="edui-container"><div class="edui-editor-body"></div></div>').insertBefore($editorCont);editor.$container=$container;editor.container=$container[0];editor.$body=$editorCont;if(browser.ie&&browser.ie9above){var $span=$('<span style="padding:0;margin:0;height:0;width:0"></span>');$span.insertAfter($container);}$container.find(".edui-editor-body").append($editorCont).before(this.createToolbar(editor.options,editor));$container.find(".edui-toolbar").append($('<div class="edui-dialog-container"></div>'));return $container;},createToolbar:function(options,editor){var me=this;var $toolbar=$.eduitoolbar(),toolbar=$toolbar.edui();if(options.toolbar&&options.toolbar.length){var btns=[];$.each(options.toolbar,function(i,uiNames){$.each(uiNames.split(/\s+/),function(index,name){if(name=="|"){$.eduiseparator&&btns.push($.eduiseparator());}else{var ui=me.getUI(editor,name);if(name=="fullscreen"){ui&&btns.unshift(ui);}else{ui&&btns.push(ui);}}});btns.length&&toolbar.appendToBtnmenu(btns);});}else{$toolbar.find(".edui-btn-toolbar").remove();}return $toolbar;}});})();UE.registerUI("bold italic redo undo source underline strikethrough superscript subscript insertorderedlist insertunorderedlist "+"cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat",function(name){var me=this;var $btn=$.eduibutton({icon:name,click:function(){me.execCommand(name);},title:this.getLang("labelMap")[name]||""});this.addListener("selectionchange",function(){var state=this.queryCommandState(name);$btn.edui().disabled(state==-1).active(state==1);});return $btn;});(function(){var STATUS_CACHE={},STATUS_LIST=["width","height","position","top","left","margin","padding","overflowX","overflowY"],CONTENT_AREA_STATUS={},DOCUMENT_STATUS={},DOCUMENT_ELEMENT_STATUS={},FULLSCREENS={};UE.registerUI("fullscreen",function(name){var me=this,fullscreenHandler=new Fullscreen(me),$button=$.eduibutton({"icon":"fullscreen","title":(me.options.labelMap&&me.options.labelMap[name])||me.getLang("labelMap."+name),"click":function(){fullscreenHandler.toggle();}});fullscreenHandler.attachButton($button);me.addListener("selectionchange",function(){var state=this.queryCommandState(name);$button.edui().disabled(state==-1).active(state==1);});return $button;});UE.commands["fullscreen"]={queryCommandState:function(){return this._edui_fullscreen_status;}};function Fullscreen(editor){var me=this;if(!editor){throw new Error("invalid params, notfound editor");}me.editor=editor;me.buttons=[];FULLSCREENS[editor.uid]=this;editor.addListener("destroy",function(){delete FULLSCREENS[editor.uid];me.editor=null;});if(editor.options.fullscreen){editor.addListener("ready",function(){me.toggle();});}}Fullscreen.prototype={toggle:function(){var editor=this.editor,_edui_fullscreen_status=this.isFullState();editor.fireEvent("beforefullscreenchange",!_edui_fullscreen_status);this.update(!_edui_fullscreen_status);!_edui_fullscreen_status?this.enlarge():this.revert();editor.fireEvent("afterfullscreenchange",!_edui_fullscreen_status);if(editor.body.contentEditable==="true"){editor.fireEvent("fullscreenchanged",!_edui_fullscreen_status);}editor.fireEvent("selectionchange");},attachButton:function($btn){this.buttons.push($btn);},enlarge:function(){this.saveSataus();this.setDocumentStatus();this.resize();},revert:function(){var options=this.editor.options,height=/%$/.test(options.initialFrameHeight)?"100%":(options.initialFrameHeight-this.getStyleValue("padding-top")-this.getStyleValue("padding-bottom")-this.getStyleValue("border-width"));$.IE6&&this.getEditorHolder().style.setExpression("height","this.scrollHeight <= "+height+' ? "'+height+'px" : "auto"');this.revertContainerStatus();this.revertContentAreaStatus();this.revertDocumentStatus();},update:function(isFull){this.editor._edui_fullscreen_status=isFull;},resize:function(){var $win=null,height=0,width=0,borderWidth=0,paddingWidth=0,editor=this.editor,me=this,bound=null,editorBody=null;if(!this.isFullState()){return;}$win=$(window);width=$win.width();height=$win.height();editorBody=this.getEditorHolder();borderWidth=parseInt(domUtils.getComputedStyle(editorBody,"border-width"),10)||0;borderWidth+=parseInt(domUtils.getComputedStyle(editor.container,"border-width"),10)||0;paddingWidth+=parseInt(domUtils.getComputedStyle(editorBody,"padding-left"),10)+parseInt(domUtils.getComputedStyle(editorBody,"padding-right"),10)||0;$.IE6&&editorBody.style.setExpression("height",null);bound=this.getBound();$(editor.container).css({width:width+"px",height:height+"px",position:!$.IE6?"fixed":"absolute",top:bound.top,left:bound.left,margin:0,padding:0,overflowX:"hidden",overflowY:"hidden"});$(editorBody).css({width:width-2*borderWidth-paddingWidth+"px",height:height-2*borderWidth-$(".edui-toolbar",editor.container).outerHeight()-$(".edui-bottombar",editor.container).outerHeight()+"px",overflowX:"hidden",overflowY:"auto"});},saveSataus:function(){var styles=this.editor.container.style,tmp=null,cache={};for(var i=0,len=STATUS_LIST.length;i<len;i++){tmp=STATUS_LIST[i];cache[tmp]=styles[tmp];}STATUS_CACHE[this.editor.uid]=cache;this.saveContentAreaStatus();this.saveDocumentStatus();},saveContentAreaStatus:function(){var $holder=$(this.getEditorHolder());CONTENT_AREA_STATUS[this.editor.uid]={width:$holder.css("width"),overflowX:$holder.css("overflowX"),overflowY:$holder.css("overflowY"),height:$holder.css("height")};},saveDocumentStatus:function(){var $doc=$(this.getEditorDocumentBody());DOCUMENT_STATUS[this.editor.uid]={overflowX:$doc.css("overflowX"),overflowY:$doc.css("overflowY")};DOCUMENT_ELEMENT_STATUS[this.editor.uid]={overflowX:$(this.getEditorDocumentElement()).css("overflowX"),overflowY:$(this.getEditorDocumentElement()).css("overflowY")};},revertContainerStatus:function(){$(this.editor.container).css(this.getEditorStatus());},revertContentAreaStatus:function(){var holder=this.getEditorHolder(),state=this.getContentAreaStatus();if(this.supportMin()){delete state.height;holder.style.height=null;}$(holder).css(state);},revertDocumentStatus:function(){var status=this.getDocumentStatus();$(this.getEditorDocumentBody()).css("overflowX",status.body.overflowX);$(this.getEditorDocumentElement()).css("overflowY",status.html.overflowY);},setDocumentStatus:function(){$(this.getEditorDocumentBody()).css({overflowX:"hidden",overflowY:"hidden"});$(this.getEditorDocumentElement()).css({overflowX:"hidden",overflowY:"hidden"});},isFullState:function(){return !!this.editor._edui_fullscreen_status;},getEditorStatus:function(){return STATUS_CACHE[this.editor.uid];},getContentAreaStatus:function(){return CONTENT_AREA_STATUS[this.editor.uid];},getEditorDocumentElement:function(){return this.editor.container.ownerDocument.documentElement;},getEditorDocumentBody:function(){return this.editor.container.ownerDocument.body;},getEditorHolder:function(){return this.editor.body;},getDocumentStatus:function(){return{"body":DOCUMENT_STATUS[this.editor.uid],"html":DOCUMENT_ELEMENT_STATUS[this.editor.uid]};},supportMin:function(){var node=null;if(!this._support){node=document.createElement("div");this._support="minWidth" in node.style;node=null;}return this._support;},getBound:function(){var tags={html:true,body:true},result={top:0,left:0},offsetParent=null;if(!$.IE6){return result;}offsetParent=this.editor.container.offsetParent;if(offsetParent&&!tags[offsetParent.nodeName.toLowerCase()]){tags=offsetParent.getBoundingClientRect();result.top=-tags.top;result.left=-tags.left;}return result;},getStyleValue:function(attr){return parseInt(domUtils.getComputedStyle(this.getEditorHolder(),attr));}};$.extend(Fullscreen,{listen:function(){var timer=null;if(Fullscreen._hasFullscreenListener){return;}Fullscreen._hasFullscreenListener=true;$(window).on("resize",function(){if(timer!==null){window.clearTimeout(timer);timer=null;}timer=window.setTimeout(function(){for(var key in FULLSCREENS){FULLSCREENS[key].resize();}timer=null;},50);});}});Fullscreen.listen();})();UE.registerUI("fontfamily",function(name){var me=this,fontLabel=(me.options.labelMap&&me.options.labelMap[name])||me.getLang("labelMap."+name),options={label:fontLabel,title:fontLabel,items:me.options.fontfamily},fontFamily=options.items,$fontFamilyCombobox=null,comboboxWidget=null,temp=null,tempItems=[];options.itemStyles=[];options.value=[];options.autowidthitem=[];for(var i=0,len=fontFamily.length;i<len;i++){temp=fontFamily[i].val;tempItems.push(temp.split(/\s*,\s*/)[0]);options.itemStyles.push("font-family: "+temp);options.value.push(temp);options.autowidthitem.push(wordCountAdaptive(tempItems[i]));}options.items=tempItems;$fontFamilyCombobox=$.eduibuttoncombobox(options).css("zIndex",me.getOpt("zIndex")+1);comboboxWidget=$fontFamilyCombobox.edui();comboboxWidget.on("comboboxselect",function(evt,res){me.execCommand(name,res.value);}).on("beforeshow",function(){if($fontFamilyCombobox.parent().length===0){$fontFamilyCombobox.appendTo(me.$container.find(".edui-dialog-container"));}});this.addListener("selectionchange",function(evt){var state=this.queryCommandState(name);comboboxWidget.button().edui().disabled(state==-1).active(state==1);var fontFamily=this.queryCommandValue(name);fontFamily=fontFamily.replace(/['"]/g,"").toLowerCase();comboboxWidget.selectItemByLabel(fontFamily.split(/['|"]?\s*,\s*[\1]?/));});return comboboxWidget.button().addClass("edui-combobox");function wordCountAdaptive(word,hasSuffix){var $tmpNode=$("<span>").html(word).css({display:"inline",position:"absolute",top:-10000000,left:-100000}).appendTo(document.body),width=$tmpNode.width();$tmpNode.remove();$tmpNode=null;if(width<50){return word;}else{word=word.slice(0,hasSuffix?-4:-1);if(!word.length){return"...";}return wordCountAdaptive(word+"...",true);}}});UE.registerUI("fontsize",function(name){var me=this,sizeLabel=(me.options.labelMap&&me.options.labelMap[name])||me.getLang("labelMap."+name),options={label:sizeLabel,title:sizeLabel,autoRecord:false,comboboxName:"fontsize",items:me.options.fontsize},$fontSizeCombobox=null,$btn=null;options=parseOption(options);$fontSizeCombobox=$.eduibuttoncombobox(options).css("zIndex",me.getOpt("zIndex")+1);$btn=$fontSizeCombobox.edui().button();$fontSizeCombobox.on("comboboxselect",function(evt,res){me.execCommand(name,res.value+"px");});$fontSizeCombobox.edui().on("beforeshow",function(){if(this.root().parent().length===0){this.root().appendTo(me.$container.find(".edui-dialog-container"));}});$btn.addClass("edui-combobox");this.addListener("selectionchange",function(){var state=this.queryCommandState(name);$btn.edui().disabled(state==-1).active(state==1);var fontSize=this.queryCommandValue(name);fontSize+="";$fontSizeCombobox.edui().selectItemByLabel(fontSize.replace("px",""));});return $btn;function parseOption(options){var fontSize=options.items,temp=null,tempItems=[];options.itemStyles=[];options.value=[];for(var i=0,len=fontSize.length;i<len;i++){temp=fontSize[i];tempItems.push(temp);options.itemStyles.push("font-size: "+temp+"px");}options.value=options.items;options.items=tempItems;return options;}});$.each(["forecolor","backcolor"],function(i,v){UE.registerUI(v,function(name){function getCurrentColor(){return domUtils.getComputedStyle($colorLabel[0],"background-color");}var me=this,$colorPickerWidget=null,$colorLabel=null,$btn=null;this.addListener("selectionchange",function(){var state=this.queryCommandState(name);$btn.edui().disabled(state==-1).active(state==1);});$btn=$.eduicolorsplitbutton({icon:name,caret:true,title:me.getLang("labelMap")[name],click:function(){me.execCommand(name,getCurrentColor());}});$colorLabel=$btn.edui().colorLabel();$colorPickerWidget=$.eduicolorpicker({lang_clearColor:me.getLang("clearColor")||"",lang_themeColor:me.getLang("themeColor")||"",lang_standardColor:me.getLang("standardColor")||""}).on("pickcolor",function(evt,color){window.setTimeout(function(){$colorLabel.css("backgroundColor",color);me.execCommand(name,color);},0);}).on("show",function(){UE.setActiveWidget(colorPickerWidget.root());}).css("zIndex",me.getOpt("zIndex")+1);$btn.edui().on("arrowclick",function(){if(!$colorPickerWidget.parent().length){me.$container.find(".edui-dialog-container").append($colorPickerWidget);}$colorPickerWidget.edui().show($btn,{caretDir:"down",offsetTop:-5,offsetLeft:8,caretLeft:11,caretTop:-8});}).register("click",$btn,function(){$colorPickerWidget.edui().hide();});return $btn;});});UE.registerUI("link image map insertvideo",function(name){var me=this,currentRange,$dialog,dialogUrl={insertvideo:"video"},curDialogUrl=dialogUrl[name]||name,opt={title:(me.options.labelMap&&me.options.labelMap[name])||me.getLang("labelMap."+name),url:me.options.UEDITOR_HOME_URL+"dialogs/"+curDialogUrl+"/"+curDialogUrl+".js"};var $btn=$.eduibutton({icon:name,title:this.getLang("labelMap")[name]||""});utils.loadFile(document,{src:opt.url,tag:"script",type:"text/javascript",defer:"defer"},function(){var data=UE.getWidgetData(name);if(data.buttons){var ok=data.buttons.ok;if(ok){opt.oklabel=ok.label||me.getLang("ok");if(ok.exec){opt.okFn=function(){return $.proxy(ok.exec,null,me,$dialog)();};}}var cancel=data.buttons.cancel;if(cancel){opt.cancellabel=cancel.label||me.getLang("cancel");if(cancel.exec){opt.cancelFn=function(){return $.proxy(cancel.exec,null,me,$dialog)();};}}}data.width&&(opt.width=data.width);data.height&&(opt.height=data.height);$dialog=$.eduimodal(opt);$dialog.attr("id","edui-dialog-"+name).find(".edui-modal-body").addClass("edui-dialog-"+name+"-body");$dialog.edui().on("beforehide",function(){var rng=me.selection.getRange();if(rng.equals(currentRange)){rng.select();}}).on("beforeshow",function(){var $root=this.root(),win=null,offset=null;currentRange=me.selection.getRange();if(!$root.parent()[0]){me.$container.find(".edui-dialog-container").append($root);}if($.IE6){win={width:$(window).width(),height:$(window).height()};offset=$root.parents(".edui-toolbar")[0].getBoundingClientRect();$root.css({position:"absolute",margin:0,left:(win.width-$root.width())/2-offset.left,top:100-offset.top});}UE.setWidgetBody(name,$dialog,me);}).on("afterbackdrop",function(){this.$backdrop.css("zIndex",me.getOpt("zIndex")+1).appendTo(me.$container.find(".edui-dialog-container"));$dialog.css("zIndex",me.getOpt("zIndex")+2);}).on("beforeok",function(){try{currentRange.select();}catch(e){}}).attachTo($btn);});me.addListener("selectionchange",function(){var state=this.queryCommandState(name);$btn.edui().disabled(state==-1).active(state==1);});return $btn;});UE.registerUI("emotion",function(name){var me=this,url=me.options.UEDITOR_HOME_URL+"dialogs/"+name+"/"+name+".js";var $btn=$.eduibutton({icon:name,title:this.getLang("labelMap")[name]||""});utils.loadFile(document,{src:url,tag:"script",type:"text/javascript",defer:"defer"},function(){var opt={url:url};var data=UE.getWidgetData(name);data.width&&(opt.width=data.width);data.height&&(opt.height=data.height);$.eduipopup(opt).css("zIndex",me.options.zIndex+1).edui().on("beforeshow",function(){var $root=this.root();if(!$root.parent().length){me.$container.find(".edui-dialog-container").append($root);}UE.setWidgetBody(name,$root,me);}).attachTo($btn,{offsetTop:-5,offsetLeft:10,caretLeft:11,caretTop:-8});me.addListener("selectionchange",function(){var state=this.queryCommandState("emotion");$btn.edui().disabled(state==-1).active(state==1);});});return $btn;});UE.ready(function(){var me=this,$imagescale;if(browser.webkit){me.addListener("click",function(type,e){var range=me.selection.getRange(),img=range.getClosedNode();if(img&&img.tagName=="IMG"){if(!$imagescale){$imagescale=$.eduiscale().css("zIndex",me.options.zIndex);me.$container.append($imagescale);var _keyDownHandler=function(e){$imagescale.edui().hide();},_mouseDownHandler=function(e){var ele=e.target||e.srcElement;if(ele&&ele.className.indexOf("edui-scale")==-1){_keyDownHandler(e);}},timer;$imagescale.edui().on("aftershow",function(e){$(document).bind("keydown",_keyDownHandler);$(document).bind("mousedown",_mouseDownHandler);me.selection.getNative().removeAllRanges();}).on("afterhide",function(e){$(document).unbind("keydown",_keyDownHandler);$(document).unbind("mousedown",_mouseDownHandler);var target=$imagescale.edui().getScaleTarget();if(target.parentNode){me.selection.getRange().selectNode(target).select();}}).on("mousedown",function(e){me.selection.getNative().removeAllRanges();var ele=e.target||e.srcElement;if(ele&&ele.className.indexOf("edui-scale-hand")==-1){timer=setTimeout(function(){$imagescale.edui().hide();},200);}}).on("mouseup",function(e){var ele=e.target||e.srcElement;if(ele&&ele.className.indexOf("edui-scale-hand")==-1){clearTimeout(timer);}});}$imagescale.edui().show($(img));}else{if($imagescale&&$imagescale.css("display")!="none"){$imagescale.edui().hide();}}});me.addListener("click",function(type,e){if(e.target.tagName=="IMG"){var range=new dom.Range(me.document);range.selectNode(e.target).select();}});}});UE.ready(function(){var me=this,lang=me.getLang();me.setOpt({topOffset:0});var optsAutoFloatEnabled=me.options.autoFloatEnabled!==false,topOffset=me.options.topOffset;if(!optsAutoFloatEnabled){return;}var LteIE6=browser.ie&&browser.version<=6,quirks=browser.quirks;function checkHasUI(){if(!UE.ui){alert(lang.autofloatMsg);return 0;}return 1;}function fixIE6FixedPos(){var docStyle=document.body.style;docStyle.backgroundImage='url("about:blank")';docStyle.backgroundAttachment="fixed";}var bakCssText,placeHolder=document.createElement("div"),toolbarBox,orgTop,getPosition=function(element){var bcr;try{bcr=element.getBoundingClientRect();}catch(e){bcr={left:0,top:0,height:0,width:0};}var rect={left:Math.round(bcr.left),top:Math.round(bcr.top),height:Math.round(bcr.bottom-bcr.top),width:Math.round(bcr.right-bcr.left)};var doc;while((doc=element.ownerDocument)!==document&&(element=domUtils.getWindow(doc).frameElement)){bcr=element.getBoundingClientRect();rect.left+=bcr.left;rect.top+=bcr.top;}rect.bottom=rect.top+rect.height;rect.right=rect.left+rect.width;return rect;},flag=true;var isFullScreening=false;function setFloating(){if(isFullScreening){return;}var toobarBoxPos=domUtils.getXY(toolbarBox),origalFloat=domUtils.getComputedStyle(toolbarBox,"position"),origalLeft=domUtils.getComputedStyle(toolbarBox,"left");toolbarBox.style.width=toolbarBox.offsetWidth+"px";toolbarBox.style.zIndex=me.options.zIndex*1+1;toolbarBox.parentNode.insertBefore(placeHolder,toolbarBox);if(LteIE6||(quirks&&browser.ie)){if(toolbarBox.style.position!="absolute"){toolbarBox.style.position="absolute";}toolbarBox.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-orgTop+topOffset+"px";}else{if(browser.ie7Compat&&flag){flag=false;toolbarBox.style.left=domUtils.getXY(toolbarBox).x-document.documentElement.getBoundingClientRect().left+2+"px";}if(toolbarBox.style.position!="fixed"){toolbarBox.style.position="fixed";toolbarBox.style.top=topOffset+"px";((origalFloat=="absolute"||origalFloat=="relative")&&parseFloat(origalLeft))&&(toolbarBox.style.left=toobarBoxPos.x+"px");}}}function unsetFloating(){flag=true;if(placeHolder.parentNode){placeHolder.parentNode.removeChild(placeHolder);}toolbarBox.style.cssText=bakCssText;}function updateFloating(){var rect3=getPosition(me.container);var offset=me.options.toolbarTopOffset||0;if(rect3.top<0&&rect3.bottom-toolbarBox.offsetHeight>offset){setFloating();}else{unsetFloating();}}var defer_updateFloating=utils.defer(function(){updateFloating();},browser.ie?200:100,true);me.addListener("destroy",function(){domUtils.un(window,["scroll","resize"],updateFloating);me.removeListener("keydown",defer_updateFloating);});if(checkHasUI(me)){toolbarBox=$(".edui-toolbar",me.container)[0];orgTop=getPosition(toolbarBox).top;bakCssText=toolbarBox.style.cssText;placeHolder.style.height=toolbarBox.offsetHeight+"px";if(LteIE6){fixIE6FixedPos();}domUtils.on(window,["scroll","resize"],updateFloating);me.addListener("keydown",defer_updateFloating);me.addListener("beforefullscreenchange",function(t,enabled){if(enabled){unsetFloating();isFullScreening=enabled;}});me.addListener("fullscreenchanged",function(t,enabled){if(!enabled){updateFloating();}isFullScreening=enabled;});me.addListener("sourcemodechanged",function(t,enabled){setTimeout(function(){updateFloating();},0);});me.addListener("clearDoc",function(){setTimeout(function(){updateFloating();},0);});}});UE.ready(function(){var me=this;me.addListener("fullscreenchanged",function(){me.$container.find("textarea").width(me.$body.width()-10).height(me.$body.height());});});})();